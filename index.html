<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="PyData-Global_files/libs/clipboard/clipboard.min.js"></script>
<script src="PyData-Global_files/libs/quarto-html/tabby.min.js"></script>
<script src="PyData-Global_files/libs/quarto-html/popper.min.js"></script>
<script src="PyData-Global_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="PyData-Global_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="PyData-Global_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="PyData-Global_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="PyData-Global_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.528">

  <meta name="author" content="Alonso Silva (GitHub: alonsosilvaallende)">
  <title>Building Knowledge Graph-Based Agents with Structured Text Generation and Open-Weights Models</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="PyData-Global_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="PyData-Global_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="PyData-Global_files/libs/revealjs/dist/theme/quarto.css">
  <link href="PyData-Global_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="PyData-Global_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="PyData-Global_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="PyData-Global_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Building Knowledge Graph-Based Agents with Structured Text Generation and Open-Weights Models</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Alonso Silva (GitHub: alonsosilvaallende) 
</div>
</div>
</div>

</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#/introduction" id="/toc-introduction">Introduction</a></li>
<li><a href="#/what-is-structured-generation" id="/toc-what-is-structured-generation">What is Structured Generation?</a></li>
<li><a href="#/knowledge-graph-generation" id="/toc-knowledge-graph-generation">Knowledge Graph Generation</a></li>
<li><a href="#/kg-based-agents" id="/toc-kg-based-agents">KG-based Agents</a></li>
<li><a href="#/conclusions" id="/toc-conclusions">Conclusions</a></li>
</ul>
</nav>
</section>
<section id="hi-im-alonso" class="slide level3 smaller">
<h3>hi 👋, I’m Alonso</h3>
<ul>
<li>Researcher on Generative AI at Nokia Bell Labs</li>
<li>AI Consultant/Trainer</li>
<li>PhD at Inria, post-doc at UC Berkeley</li>
<li>Based in Paris, France</li>
<li><a href="https://alonsosilvaallende.github.io/">https://alonsosilvaallende.github.io/</a>
<ul>
<li>Github: <a href="https://github.com/alonsosilvaallende/">https://github.com/alonsosilvaallende/</a></li>
<li>Twitter: <a href="https://twitter.com/alonsosilva"><span class="citation" data-cites="alonsosilva">@alonsosilva</span></a></li>
<li>Bluesky: <a href="https://bsky.app/profile/alonsosilva.bsky.social">https://bsky.app/profile/alonsosilva.bsky.social</a></li>
<li>Mastodon: <a href="https://sigmoid.social/@alonsosilva">https://sigmoid.social/<span class="citation" data-cites="alonsosilva">@alonsosilva</span></a></li>
<li>Linkedin: <a href="https://www.linkedin.com/in/alonsosilvaallende/">https://www.linkedin.com/in/alonsosilvaallende/</a></li>
</ul></li>
</ul>
</section>
<section id="section" class="slide level3">
<h3></h3>
<ul>
<li>Slides: <a href="https://alonsosilvaallende.github.io/2024-PyData-Global/">alonsosilvaallende.github.io/2024-PyData-Global/</a></li>
<li>This presentation: <a href="https://github.com/alonsosilvaallende/2024-PyData-Global/blob/main/PyData-Global.ipynb">https://github.com/alonsosilvaallende/2024-PyData-Global/blob/main/PyData-Global.ipynb</a></li>
</ul>
</section>
<section>
<section id="introduction" class="title-slide slide level1 center">
<h1>Introduction</h1>

</section>
<section id="section-1" class="title-slide slide level2 center">
<h2></h2>
<div style="margin-top: 100px; font-size: 2em; color: black;">
<p>The problem</p>
</div>
</section>

<section id="section-2" class="title-slide slide level2 center">
<h2></h2>

<img data-src="./assets/scikit-llm.jpg" title="scikit-llm Homepage" style="width:50.0%" class="r-stretch quarto-figure-center"><p class="caption">scikit-llm: <a href="https://skllm.beastbyte.ai/">https://skllm.beastbyte.ai/</a></p></section>
<section id="show-me-the-prompt" class="slide level3">
<h3>Show me the prompt!</h3>

<img data-src="./assets/scikit-llm-prompt.jpg" title="scikit-llm prompt" style="width:25.0%" class="r-stretch quarto-figure-center"><p class="caption">scikit-llm prompts: <a href="https://github.com/iryna-kondr/scikit-llm/blob/main/skllm/prompts/templates.py">https://github.com/iryna-kondr/scikit-llm/blob/main/skllm/prompts/templates.py</a></p></section>
<section id="section-3" class="slide level3">
<h3></h3>

<img data-src="./assets/we-can-do-better.jpg" title="We can do better!" style="width:50.0%" class="r-stretch"></section>
<section id="section-4" class="slide level3">
<h3></h3>
<div style="margin-top: 200px; font-size: 2em; color: black;">
<p>What is NOT Structured Generation?</p>
</div>
</section>
<section id="structured-outputs-in-the-style-of-instructormarvin-libraries" class="slide level3">
<h3>Structured Outputs (in the style of Instructor/Marvin libraries)</h3>
<ul>
<li>Instructor: <a href="https://python.useinstructor.com/">https://python.useinstructor.com/</a></li>
<li>Marvin: <a href="https://www.askmarvin.ai/">https://www.askmarvin.ai/</a></li>
</ul>
</section>
<section id="structured-outputs-in-code" class="slide level3">
<h3>Structured Outputs in Code</h3>
<div id="53a0a841-88d2-4265-b635-d28e0b772263" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:10:35.954800Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:10:35.954248Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:10:40.527253Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:10:40.526307Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:10:35.954755Z&quot;}" data-scrolled="true" data-execution_count="2">
<div class="sourceCode cell-code" id="annotated-cell-1"><pre class="sourceCode numberSource python code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-1-1"><a href="#annotated-cell-1-1"></a><span class="im">import</span> llama_cpp  </span>
<span id="annotated-cell-1-2"><a href="#annotated-cell-1-2"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-1-3" class="code-annotation-target"><a href="#annotated-cell-1-3"></a>model_id <span class="op">=</span> <span class="st">"NousResearch/Hermes-3-Llama-3.1-8B"</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-1-4" class="code-annotation-target"><a href="#annotated-cell-1-4"></a>llm <span class="op">=</span> llama_cpp.Llama(</span>
<span id="annotated-cell-1-5"><a href="#annotated-cell-1-5"></a>    <span class="st">"/big_storage/llms/models/Hermes-3-Llama-3.1-8B.Q6_K.gguf"</span>,</span>
<span id="annotated-cell-1-6"><a href="#annotated-cell-1-6"></a>    tokenizer<span class="op">=</span>llama_cpp.llama_tokenizer.LlamaHFTokenizer.from_pretrained(</span>
<span id="annotated-cell-1-7"><a href="#annotated-cell-1-7"></a>        model_id</span>
<span id="annotated-cell-1-8"><a href="#annotated-cell-1-8"></a>    ),</span>
<span id="annotated-cell-1-9"><a href="#annotated-cell-1-9"></a>    n_gpu_layers<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="annotated-cell-1-10"><a href="#annotated-cell-1-10"></a>    flash_attn<span class="op">=</span><span class="va">True</span>,</span>
<span id="annotated-cell-1-11"><a href="#annotated-cell-1-11"></a>    n_ctx<span class="op">=</span><span class="dv">8192</span>,</span>
<span id="annotated-cell-1-12"><a href="#annotated-cell-1-12"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="annotated-cell-1-13"><a href="#annotated-cell-1-13"></a>    chat_format<span class="op">=</span><span class="st">"chatml-function-calling"</span></span>
<span id="annotated-cell-1-14"><a href="#annotated-cell-1-14"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="3" data-code-annotation="1"><a href="https://nousresearch.com/hermes3/">Hermes 3</a> by <a href="https://nousresearch.com/">NousResearch</a></span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="4" data-code-annotation="2"><a href="https://llama-cpp-python.readthedocs.io/">llama-cpp-python</a> python bindings for <a href="https://github.com/ggerganov/llama.cpp">llama.cpp</a></span>
</dd>
</dl>
</div>
</div>
</section>
<section id="structured-outputs-in-code-1" class="slide level3">
<h3>Structured Outputs in Code</h3>
<div id="1dab1c8f-18c7-4fcd-98ad-42f8eaeb0013" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:10:40.528038Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:10:40.527821Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:10:40.710979Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:10:40.710588Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:10:40.528024Z&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href=""></a><span class="im">from</span> typing <span class="im">import</span> Literal</span>
<span id="cb1-2"><a href=""></a></span>
<span id="cb1-3"><a href=""></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, Field</span>
<span id="cb1-4"><a href=""></a></span>
<span id="cb1-5"><a href=""></a></span>
<span id="cb1-6"><a href=""></a><span class="kw">class</span> Sentiment(BaseModel):</span>
<span id="cb1-7"><a href=""></a>    <span class="co">"""Correctly inferred `Sentiment` with all the required parameters</span></span>
<span id="cb1-8"><a href=""></a><span class="co">    with correct types."""</span></span>
<span id="cb1-9"><a href=""></a></span>
<span id="cb1-10"><a href=""></a>    label: Literal[<span class="st">"Positive"</span>, <span class="st">"Negative"</span>] <span class="op">=</span> Field(</span>
<span id="cb1-11"><a href=""></a>        ..., description<span class="op">=</span><span class="st">"Sentiment of the text"</span></span>
<span id="cb1-12"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="structured-outputs-in-code-2" class="slide level3">
<h3>Structured Outputs in Code</h3>
<div id="c08d3308-7b15-4001-8f59-8c13cf9f4eda" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:10:40.711607Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:10:40.711440Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:10:41.082866Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:10:41.081857Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:10:40.711594Z&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href=""></a><span class="im">from</span> langchain_core.utils.function_calling <span class="im">import</span> convert_to_openai_tool</span>
<span id="cb2-2"><a href=""></a></span>
<span id="cb2-3"><a href=""></a>tools <span class="op">=</span> [convert_to_openai_tool(Sentiment)]</span>
<span id="cb2-4"><a href=""></a>tools</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>[{'type': 'function',
  'function': {'name': 'Sentiment',
   'description': 'Correctly inferred `Sentiment` with all the required parameters\nwith correct types.',
   'parameters': {'properties': {'label': {'description': 'Sentiment of the text',
      'enum': ['Positive', 'Negative'],
      'type': 'string'}},
    'required': ['label'],
    'type': 'object'}}}]</code></pre>
</div>
</div>
</section>
<section id="structured-outputs-in-code-3" class="slide level3">
<h3>Structured Outputs in Code</h3>
<div id="6f3133ef-c7ba-4d4a-8790-fbb29e39c24b" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:10:41.092779Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:10:41.092143Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:10:41.523797Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:10:41.523155Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:10:41.092739Z&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="1-17|1|1,8-9|1,8-9,13-14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href=""></a>user_input <span class="op">=</span> <span class="st">"You are great"</span></span>
<span id="cb4-2"><a href=""></a></span>
<span id="cb4-3"><a href=""></a>output <span class="op">=</span> llm.create_chat_completion(</span>
<span id="cb4-4"><a href=""></a>    messages<span class="op">=</span>[</span>
<span id="cb4-5"><a href=""></a>        {</span>
<span id="cb4-6"><a href=""></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb4-7"><a href=""></a>            <span class="st">"content"</span>: (</span>
<span id="cb4-8"><a href=""></a>                <span class="st">"What is the sentiment conveyed in the following text: "</span></span>
<span id="cb4-9"><a href=""></a>                <span class="ss">f"</span><span class="sc">{</span>user_input<span class="sc">}</span><span class="ss">."</span></span>
<span id="cb4-10"><a href=""></a>            ),</span>
<span id="cb4-11"><a href=""></a>        },</span>
<span id="cb4-12"><a href=""></a>    ],</span>
<span id="cb4-13"><a href=""></a>    tools<span class="op">=</span>tools,</span>
<span id="cb4-14"><a href=""></a>    tool_choice<span class="op">=</span>{<span class="st">"type"</span>: <span class="st">"function"</span>, <span class="st">"function"</span>: {<span class="st">"name"</span>: <span class="st">"Sentiment"</span>}},</span>
<span id="cb4-15"><a href=""></a>)</span>
<span id="cb4-16"><a href=""></a></span>
<span id="cb4-17"><a href=""></a>output[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"tool_calls"</span>][<span class="dv">0</span>][<span class="st">"function"</span>][<span class="st">"arguments"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>'{ "label": "Positive"}'</code></pre>
</div>
</div>
</section>

<section id="section-5" class="title-slide slide level2 center">
<h2></h2>

<img data-src="./assets/we-can-do-better.jpg" title="We can do better!" style="width:50.0%" class="r-stretch"></section>
</section>
<section>
<section id="what-is-structured-generation" class="title-slide slide level1 center">
<h1>What is Structured Generation?</h1>

</section>
<section id="section-6" class="slide level3 nostretch">
<h3></h3>
<p><img data-src="./assets/outlines-logo.webp" title="Outlines logo" style="width:40.0%"></p>
<p><a href="https://dottxt-ai.github.io/outlines/">https://dottxt-ai.github.io/outlines/</a></p>
</section>
<section id="observation-llms-are-samplers" class="slide level3">
<h3>Observation: LLMs are samplers</h3>
<p><a href="https://alonsosilva-nexttokenprediction.hf.space">https://alonsosilva-nexttokenprediction.hf.space</a></p>
<div id="c794ba07-f3f4-4048-a288-3b68fa1140cc" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:10:41.524466Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:10:41.524319Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:10:41.528669Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:10:41.528090Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:10:41.524451Z&quot;}" data-execution_count="7">
<div class="cell-output cell-output-display" data-execution_count="7">

        <iframe width="950" height="450" src="https://alonsosilva-nexttokenprediction.hf.space" frameborder="0" allowfullscreen=""></iframe>
        
</div>
</div>
</section>
<section id="we-need-to-talk-about-regular-expressions-regex" class="slide level3">
<h3>We need to talk about Regular Expressions (regex)</h3>

<img data-src="./assets/torture-regex.jpg" title="Let the torture commence meme" style="width:50.0%" class="r-stretch"></section>
<section id="regular-expression-regex" class="slide level3">
<h3>Regular Expression (regex)</h3>

<img data-src="./assets/regex_chatgpt.jpg" title="ChatGPT explaining the regex a*b*" style="width:25.0%" class="r-stretch"></section>
<section id="deterministic-finite-automata-dfa" class="slide level3 nostretch">
<h3>Deterministic Finite Automata (DFA)</h3>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="./assets/Structured-Generation-1.jpg" title="Diagrams explaining" class="quarto-figure quarto-figure-center" style="width:50.0%"></p>
</figure>
</div>
<p><a href="https://github.com/vivien000/regex-constrained-decoding">Fast, High-Fidelity LLM Decoding with Regex Constraints</a> by <a href="https://github.com/vivien000">Vivien Tran-Thien</a></p>
</section>
<section id="deterministic-finite-automata-dfa-1" class="slide level3 nostretch">
<h3>Deterministic Finite Automata (DFA)</h3>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="./assets/Structured-Generation-2.jpg" title="Diagrams explaining" class="quarto-figure quarto-figure-center" style="width:50.0%"></p>
</figure>
</div>
<p><a href="https://github.com/vivien000/regex-constrained-decoding">Fast, High-Fidelity LLM Decoding with Regex Constraints</a> by <a href="https://github.com/vivien000">Vivien Tran-Thien</a></p>
</section>
<section id="deterministic-finite-automata-dfa-2" class="slide level3 nostretch">
<h3>Deterministic Finite Automata (DFA)</h3>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="./assets/Structured-Generation-3.jpg" title="Diagrams explaining" class="quarto-figure quarto-figure-center" style="width:60.0%"></p>
</figure>
</div>
<p><a href="https://github.com/vivien000/regex-constrained-decoding">Fast, High-Fidelity LLM Decoding with Regex Constraints</a> by <a href="https://github.com/vivien000">Vivien Tran-Thien</a></p>
</section>
<section id="back-to-the-problem" class="slide level3">
<h3>Back to the problem</h3>

<img data-src="./assets/scikit-llm-prompt.jpg" title="scikit-llm prompt" style="width:25.0%" class="r-stretch quarto-figure-center"><p class="caption">scikit-llm prompts: <a href="https://github.com/iryna-kondr/scikit-llm/blob/main/skllm/prompts/templates.py">https://github.com/iryna-kondr/scikit-llm/blob/main/skllm/prompts/templates.py</a></p></section>
<section id="from-regular-expression-regex-to-deterministic-finite-automata-dfa" class="slide level3">
<h3>From regular expression (regex) to deterministic finite automata (DFA)</h3>
<p>For example, for sentiment analysis:</p>

<img data-src="./assets/fsm-simple.jpg" style="width:25.0%" class="r-stretch"></section>
<section id="life-is-hard" class="slide level3">
<h3>Life is hard</h3>

<img data-src="./assets/fsm-full.jpg" style="width:25.0%" class="r-stretch"></section>
<section id="whats-in-a-label" class="slide level3">
<h3>What’s in a “label”?</h3>

<img data-src="./assets/what-is-in-a-label.jpg" style="width:25.0%" class="r-stretch"></section>
<section id="structured-generation-in-code" class="slide level3">
<h3>Structured Generation in Code</h3>
<div id="d22b6c1d-4b76-421e-90c3-d85fd15d1965" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:10:41.529239Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:10:41.529116Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:10:42.897207Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:10:42.895888Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:10:41.529228Z&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="annotated-cell-5" data-code-line-numbers="1-13|12"><pre class="sourceCode numberSource python code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-5-1"><a href="#annotated-cell-5-1"></a><span class="im">import</span> outlines</span>
<span id="annotated-cell-5-2"><a href="#annotated-cell-5-2"></a></span>
<span id="annotated-cell-5-3"><a href="#annotated-cell-5-3"></a><span class="im">import</span> transformers</span>
<span id="annotated-cell-5-4"><a href="#annotated-cell-5-4"></a></span>
<span id="annotated-cell-5-5"><a href="#annotated-cell-5-5"></a>outlines_tokenizer <span class="op">=</span> outlines.models.TransformerTokenizer(</span>
<span id="annotated-cell-5-6"><a href="#annotated-cell-5-6"></a>    transformers.AutoTokenizer.from_pretrained(model_id)</span>
<span id="annotated-cell-5-7"><a href="#annotated-cell-5-7"></a>)</span>
<span id="annotated-cell-5-8"><a href="#annotated-cell-5-8"></a></span>
<span id="annotated-cell-5-9"><a href="#annotated-cell-5-9"></a>outlines_logits_processor <span class="op">=</span> outlines.processors.JSONLogitsProcessor(</span>
<span id="annotated-cell-5-10"><a href="#annotated-cell-5-10"></a>    Sentiment,</span>
<span id="annotated-cell-5-11"><a href="#annotated-cell-5-11"></a>    outlines_tokenizer,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-5-12" class="code-annotation-target"><a href="#annotated-cell-5-12"></a>    whitespace_pattern<span class="op">=</span><span class="vs">r"[\n\t ]*"</span></span>
<span id="annotated-cell-5-13"><a href="#annotated-cell-5-13"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="12" data-code-annotation="1">I like to give the language model some structure but also some leeway.</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="structured-generation-in-code-1" class="slide level3">
<h3>Structured Generation in Code</h3>
<div id="0d3b3dff-a14f-4aeb-a9a7-b3b708648de6" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:10:42.898730Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:10:42.898283Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:10:43.099387Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:10:43.098738Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:10:42.898698Z&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb6" data-code-line-numbers="1-18|1|1,8-9|1,8-9,13-15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href=""></a>user_input <span class="op">=</span> <span class="st">"You are great"</span></span>
<span id="cb6-2"><a href=""></a></span>
<span id="cb6-3"><a href=""></a>output <span class="op">=</span> llm.create_chat_completion(</span>
<span id="cb6-4"><a href=""></a>    messages<span class="op">=</span>[</span>
<span id="cb6-5"><a href=""></a>        {</span>
<span id="cb6-6"><a href=""></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb6-7"><a href=""></a>            <span class="st">"content"</span>: (</span>
<span id="cb6-8"><a href=""></a>                <span class="st">"What is the sentiment conveyed in the following text: "</span></span>
<span id="cb6-9"><a href=""></a>                <span class="ss">f"</span><span class="sc">{</span>user_input<span class="sc">}</span><span class="ss">."</span></span>
<span id="cb6-10"><a href=""></a>            ),</span>
<span id="cb6-11"><a href=""></a>        },</span>
<span id="cb6-12"><a href=""></a>    ],</span>
<span id="cb6-13"><a href=""></a>    logits_processor<span class="op">=</span>transformers.LogitsProcessorList(</span>
<span id="cb6-14"><a href=""></a>        [outlines_logits_processor]</span>
<span id="cb6-15"><a href=""></a>    ),</span>
<span id="cb6-16"><a href=""></a>)</span>
<span id="cb6-17"><a href=""></a></span>
<span id="cb6-18"><a href=""></a>output[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"content"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>'{ "label": "Positive" }'</code></pre>
</div>
</div>
</section>
<section id="structured-outputs-structured-generation" class="title-slide slide level2 center">
<h2>Structured Outputs + Structured Generation</h2>

</section>
<section id="section-7" class="slide level3">
<h3></h3>
<div id="04265e11-0c76-4809-ad60-7696ad5af123" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:10:43.232833Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:10:43.232688Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:10:43.624795Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:10:43.624137Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:10:43.232820Z&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="annotated-cell-7" data-code-line-numbers="1-18|12-13|14-16|1-18"><pre class="sourceCode numberSource python code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-7-1"><a href="#annotated-cell-7-1"></a>user_input <span class="op">=</span> <span class="st">"You are great"</span></span>
<span id="annotated-cell-7-2"><a href="#annotated-cell-7-2"></a>output <span class="op">=</span> llm.create_chat_completion(</span>
<span id="annotated-cell-7-3"><a href="#annotated-cell-7-3"></a>    messages<span class="op">=</span>[</span>
<span id="annotated-cell-7-4"><a href="#annotated-cell-7-4"></a>        {</span>
<span id="annotated-cell-7-5"><a href="#annotated-cell-7-5"></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="annotated-cell-7-6"><a href="#annotated-cell-7-6"></a>            <span class="st">"content"</span>: (</span>
<span id="annotated-cell-7-7"><a href="#annotated-cell-7-7"></a>                <span class="st">"What is the sentiment conveyed in the following text: "</span></span>
<span id="annotated-cell-7-8"><a href="#annotated-cell-7-8"></a>                <span class="ss">f"</span><span class="sc">{</span>user_input<span class="sc">}</span><span class="ss">."</span></span>
<span id="annotated-cell-7-9"><a href="#annotated-cell-7-9"></a>            ),</span>
<span id="annotated-cell-7-10"><a href="#annotated-cell-7-10"></a>        },</span>
<span id="annotated-cell-7-11"><a href="#annotated-cell-7-11"></a>    ],</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-7-12" class="code-annotation-target"><a href="#annotated-cell-7-12"></a>    tools<span class="op">=</span>tools,</span>
<span id="annotated-cell-7-13"><a href="#annotated-cell-7-13"></a>    tool_choice<span class="op">=</span>{<span class="st">"type"</span>: <span class="st">"function"</span>, <span class="st">"function"</span>: {<span class="st">"name"</span>: <span class="st">"Sentiment"</span>}},</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-7-14" class="code-annotation-target"><a href="#annotated-cell-7-14"></a>    logits_processor<span class="op">=</span>transformers.LogitsProcessorList(</span>
<span id="annotated-cell-7-15"><a href="#annotated-cell-7-15"></a>        [outlines_logits_processor]</span>
<span id="annotated-cell-7-16"><a href="#annotated-cell-7-16"></a>    ),</span>
<span id="annotated-cell-7-17"><a href="#annotated-cell-7-17"></a>)</span>
<span id="annotated-cell-7-18"><a href="#annotated-cell-7-18"></a>output[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"tool_calls"</span>][<span class="dv">0</span>][<span class="st">"function"</span>][<span class="st">"arguments"</span>]</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="12,13" data-code-annotation="1">Structured Outputs</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="14,15,16" data-code-annotation="2">Structured Generation</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>'{ "label": "Positive"}'</code></pre>
</div>
</div>
</section>
</section>
<section>
<section id="knowledge-graph-generation" class="title-slide slide level1 center">
<h1>Knowledge Graph Generation</h1>

</section>
<section id="section-8" class="slide level3 nostretch">
<h3></h3>
<p><img data-src="./assets/kuzu-logo.png" title="Kùzu logo" style="width:40.0%"></p>
<p>Graph database: <a href="https://kuzudb.com/">https://kuzudb.com/</a></p>
</section>
<section id="consider-a-text" class="slide level3">
<h3>Consider a text</h3>
<div id="19d5ebc8-553b-48f2-b15f-8498c0ebdd4f" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:10:43.625496Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:10:43.625289Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:10:43.629863Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:10:43.629216Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:10:43.625480Z&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href=""></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'./assets/curie.txt'</span>, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb9-2"><a href=""></a>    curie_text <span class="op">=</span> f.read()</span>
<span id="cb9-3"><a href=""></a><span class="bu">print</span>(curie_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>When Marie Curie came to the United States for the first time, in May 1921, she had already discovered the elements radium and polonium, coined the term “radio-active” and won the Nobel Prize—twice. But the Polish-born scientist, almost pathologically shy and accustomed to spending most of her time in her Paris laboratory, was stunned by the fanfare that greeted her. In 1898 she indeed identified one of the substances and named it polonium, after her homeland. Five months later, she identified a second element, which the world came to know as radium. Curie described the elements she studied as “radio-active.”

In 1894, she met Pierre Curie, a 35-year-old physicist at a French technical college who had been studying crystals and magnetism. More than a decade before, he and his brother Jacques had discovered piezoelectricity, the electric charge produced in solid materials under pressure. Pierre was taken by Marie’s uncommon intellect and drive, and he proposed to her. They were married in 1895 in a civil service attended by family and a few friends.

Both Curies shared the Nobel Prize in physics with Becquerel in 1903. It was the first Nobel to be awarded to a woman. In 1911, rumors spread that Curie was having an affair with the prominent physicist Paul Langevin, a man five years her junior who had been Pierre’s student and had worked closely with Albert Einstein. The front-page coverage of the scandal threatened to overshadow another news story later that year: her second Nobel Prize.

This one, in chemistry, was for the discovery of polonium and radium. In her acceptance speech in Stockholm, she paid tribute to her husband but also made clear that her work was independent from his, spelling out their separate contributions and describing the discoveries she had made after his death.
</code></pre>
</div>
</div>
</section>
<section id="chunk-the-text" class="slide level3">
<h3>Chunk the text</h3>
<div id="288a6b2b-e677-44c7-aef4-4c8de6a9bacf" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:10:43.630639Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:10:43.630446Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:10:43.650640Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:10:43.649756Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:10:43.630620Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href=""></a>texts <span class="op">=</span> curie_text.split(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>)</span>
<span id="cb11-2"><a href=""></a>texts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>['When Marie Curie came to the United States for the first time, in May 1921, she had already discovered the elements radium and polonium, coined the term “radio-active” and won the Nobel Prize—twice. But the Polish-born scientist, almost pathologically shy and accustomed to spending most of her time in her Paris laboratory, was stunned by the fanfare that greeted her. In 1898 she indeed identified one of the substances and named it polonium, after her homeland. Five months later, she identified a second element, which the world came to know as radium. Curie described the elements she studied as “radio-active.”',
 'In 1894, she met Pierre Curie, a 35-year-old physicist at a French technical college who had been studying crystals and magnetism. More than a decade before, he and his brother Jacques had discovered piezoelectricity, the electric charge produced in solid materials under pressure. Pierre was taken by Marie’s uncommon intellect and drive, and he proposed to her. They were married in 1895 in a civil service attended by family and a few friends.',
 'Both Curies shared the Nobel Prize in physics with Becquerel in 1903. It was the first Nobel to be awarded to a woman. In 1911, rumors spread that Curie was having an affair with the prominent physicist Paul Langevin, a man five years her junior who had been Pierre’s student and had worked closely with Albert Einstein. The front-page coverage of the scandal threatened to overshadow another news story later that year: her second Nobel Prize.',
 'This one, in chemistry, was for the discovery of polonium and radium. In her acceptance speech in Stockholm, she paid tribute to her husband but also made clear that her work was independent from his, spelling out their separate contributions and describing the discoveries she had made after his death.\n']</code></pre>
</div>
</div>
</section>
<section id="section-9" class="slide level3">
<h3></h3>
<div id="5c9c53bd-eed7-413b-b080-11023fff2252" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:10:43.651497Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:10:43.651269Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:10:43.666913Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:10:43.665762Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:10:43.651476Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href=""></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, Field</span>
<span id="cb13-2"><a href=""></a><span class="im">from</span> typing <span class="im">import</span> Optional</span>
<span id="cb13-3"><a href=""></a></span>
<span id="cb13-4"><a href=""></a><span class="kw">class</span> Node(BaseModel):</span>
<span id="cb13-5"><a href=""></a>    <span class="co">"""Node of the Knowledge Graph"""</span></span>
<span id="cb13-6"><a href=""></a>    <span class="bu">id</span>: <span class="bu">int</span> <span class="op">=</span> Field(</span>
<span id="cb13-7"><a href=""></a>        ..., description<span class="op">=</span><span class="st">"Unique identifier of the node starting at zero"</span></span>
<span id="cb13-8"><a href=""></a>    )</span>
<span id="cb13-9"><a href=""></a>    <span class="bu">type</span>: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Type of the node"</span>)</span>
<span id="cb13-10"><a href=""></a>    label: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Label of the node"</span>)</span>
<span id="cb13-11"><a href=""></a></span>
<span id="cb13-12"><a href=""></a><span class="kw">class</span> Edge(BaseModel):</span>
<span id="cb13-13"><a href=""></a>    <span class="co">"""Edge of the Knowledge Graph"""</span></span>
<span id="cb13-14"><a href=""></a>    source: <span class="bu">int</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Unique source of the edge"</span>)</span>
<span id="cb13-15"><a href=""></a>    target: <span class="bu">int</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Unique target of the edge"</span>)</span>
<span id="cb13-16"><a href=""></a>    <span class="bu">type</span>: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Type of the edge"</span>)</span>
<span id="cb13-17"><a href=""></a>    label: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Label of the edge"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-10" class="slide level3">
<h3></h3>
<div id="3fe34540-cd3f-43cd-aab4-639157e5fd4c" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:10:43.685715Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:10:43.684812Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:10:43.702293Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:10:43.701373Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:10:43.685657Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href=""></a><span class="im">from</span> typing <span class="im">import</span> List</span>
<span id="cb14-2"><a href=""></a><span class="im">from</span> langchain_core.utils.function_calling <span class="im">import</span> convert_to_openai_tool</span>
<span id="cb14-3"><a href=""></a></span>
<span id="cb14-4"><a href=""></a><span class="kw">class</span> KnowledgeGraph(BaseModel):</span>
<span id="cb14-5"><a href=""></a>    <span class="co">"""Generated Knowledge Graph"""</span></span>
<span id="cb14-6"><a href=""></a>    nodes: List[Node] <span class="op">=</span> Field(</span>
<span id="cb14-7"><a href=""></a>        ..., description<span class="op">=</span><span class="st">"List of nodes of the knowledge graph"</span>)</span>
<span id="cb14-8"><a href=""></a>    edges: List[Edge] <span class="op">=</span> Field(</span>
<span id="cb14-9"><a href=""></a>        ..., description<span class="op">=</span><span class="st">"List of edges of the knowledge graph"</span>)</span>
<span id="cb14-10"><a href=""></a></span>
<span id="cb14-11"><a href=""></a>tools <span class="op">=</span> [convert_to_openai_tool(KnowledgeGraph)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-11" class="slide level3">
<h3></h3>
<div id="0d5ee96d-d356-4e12-8e9b-f016971fecc9" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:10:43.704098Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:10:43.703518Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:10:43.715063Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:10:43.714130Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:10:43.704038Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb15" data-code-line-numbers="6-9,14-15|1-18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href=""></a><span class="kw">def</span> build_messages(text: <span class="bu">str</span>):</span>
<span id="cb15-2"><a href=""></a>    messages <span class="op">=</span> [</span>
<span id="cb15-3"><a href=""></a>        {</span>
<span id="cb15-4"><a href=""></a>            <span class="st">"role"</span>: <span class="st">"system"</span>,</span>
<span id="cb15-5"><a href=""></a>            <span class="st">"content"</span>: (</span>
<span id="cb15-6"><a href=""></a>                <span class="st">"You are a world class AI model who answers questions "</span> </span>
<span id="cb15-7"><a href=""></a>                <span class="st">"in JSON with correct Pydantic schema. "</span></span>
<span id="cb15-8"><a href=""></a>                <span class="st">"Here's the json schema you must adhere to:</span><span class="ch">\n</span><span class="st">&lt;schema&gt;</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb15-9"><a href=""></a>                <span class="ss">f"</span><span class="sc">{</span>KnowledgeGraph<span class="sc">.</span>schema_json()<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/schema&gt;"</span></span>
<span id="cb15-10"><a href=""></a>            )</span>
<span id="cb15-11"><a href=""></a>        },{</span>
<span id="cb15-12"><a href=""></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb15-13"><a href=""></a>            <span class="st">"content"</span>: (</span>
<span id="cb15-14"><a href=""></a>                <span class="st">"Describe the following text as a detailed "</span> </span>
<span id="cb15-15"><a href=""></a>                <span class="ss">f"knowledge graph:</span><span class="ch">\n</span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb15-16"><a href=""></a>            )</span>
<span id="cb15-17"><a href=""></a>        }]</span>
<span id="cb15-18"><a href=""></a>    <span class="cf">return</span> messages</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-12" class="slide level3">
<h3></h3>
<div id="e3b1585a-da30-4dc4-968f-50faa6b348c0" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:10:43.744575Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:10:43.744100Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:10:43.750906Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:10:43.749973Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:10:43.744528Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="annotated-cell-13" data-code-line-numbers="9-13|1-18"><pre class="sourceCode numberSource python code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-13-1"><a href="#annotated-cell-13-1"></a><span class="kw">def</span> generate_assistant_message(messages):</span>
<span id="annotated-cell-13-2"><a href="#annotated-cell-13-2"></a>    outlines_logits_processor <span class="op">=</span> outlines.processors.JSONLogitsProcessor(</span>
<span id="annotated-cell-13-3"><a href="#annotated-cell-13-3"></a>        KnowledgeGraph,</span>
<span id="annotated-cell-13-4"><a href="#annotated-cell-13-4"></a>        outlines_tokenizer,</span>
<span id="annotated-cell-13-5"><a href="#annotated-cell-13-5"></a>        whitespace_pattern<span class="op">=</span><span class="vs">r"[\n\t ]*"</span></span>
<span id="annotated-cell-13-6"><a href="#annotated-cell-13-6"></a>    )</span>
<span id="annotated-cell-13-7"><a href="#annotated-cell-13-7"></a>    output <span class="op">=</span> llm.create_chat_completion(</span>
<span id="annotated-cell-13-8"><a href="#annotated-cell-13-8"></a>        messages<span class="op">=</span>messages,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-13-9" class="code-annotation-target"><a href="#annotated-cell-13-9"></a>        tools<span class="op">=</span>tools,</span>
<span id="annotated-cell-13-10"><a href="#annotated-cell-13-10"></a>        tool_choice<span class="op">=</span>{<span class="st">"type"</span>: <span class="st">"function"</span>, </span>
<span id="annotated-cell-13-11"><a href="#annotated-cell-13-11"></a>                     <span class="st">"function"</span>: {<span class="st">"name"</span>: <span class="st">"KnowledgeGraph"</span>}},</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-13-12" class="code-annotation-target"><a href="#annotated-cell-13-12"></a>        logits_processor<span class="op">=</span>transformers.LogitsProcessorList(</span>
<span id="annotated-cell-13-13"><a href="#annotated-cell-13-13"></a>            [outlines_logits_processor]),</span>
<span id="annotated-cell-13-14"><a href="#annotated-cell-13-14"></a>        temperature<span class="op">=</span><span class="dv">0</span>,</span>
<span id="annotated-cell-13-15"><a href="#annotated-cell-13-15"></a>        seed<span class="op">=</span><span class="dv">42</span>,</span>
<span id="annotated-cell-13-16"><a href="#annotated-cell-13-16"></a>        max_tokens<span class="op">=</span><span class="dv">5000</span>,</span>
<span id="annotated-cell-13-17"><a href="#annotated-cell-13-17"></a>    )</span>
<span id="annotated-cell-13-18"><a href="#annotated-cell-13-18"></a>    <span class="cf">return</span> output[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>]</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="9" data-code-annotation="1">Structured Outputs</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="12" data-code-annotation="2">Structured Generation</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="section-13" class="title-slide slide level2 center">
<h2></h2>
<div id="ccca9f8b-59a9-4722-9fd3-b5c74aa1f12a" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:10:47.959334Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:10:47.959179Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:10:51.660348Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:10:51.659695Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:10:47.959321Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href=""></a><span class="kw">def</span> generate_kg(text):</span>
<span id="cb16-2"><a href=""></a>    messages <span class="op">=</span> build_messages(text)</span>
<span id="cb16-3"><a href=""></a>    assistant_message <span class="op">=</span> generate_assistant_message(messages)</span>
<span id="cb16-4"><a href=""></a>    <span class="cf">return</span> assistant_message[<span class="st">"tool_calls"</span>][<span class="dv">0</span>][<span class="st">"function"</span>][<span class="st">"arguments"</span>]</span>
<span id="cb16-5"><a href=""></a>    </span>
<span id="cb16-6"><a href=""></a>generate_kg(<span class="st">"Alice loves Bob"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>'{"nodes": [{"id": 0, "type": "Person", "label": "Alice"}, {"id": 1, "type": "Person", "label": "Bob"}], "edges": [{"source": 0, "target": 1, "type": "LOVES", "label": "loves"}]}'</code></pre>
</div>
</div>
</section>

<section id="section-14" class="title-slide slide level2 center">
<h2></h2>
<div id="d337defd-1766-46d8-b68a-d38d777d9274" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:10:55.354731Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:10:55.354582Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:12:07.987117Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:12:07.986088Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:10:55.354717Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href=""></a><span class="im">import</span> json</span>
<span id="cb18-2"><a href=""></a></span>
<span id="cb18-3"><a href=""></a>nodes, edges <span class="op">=</span> [], []</span>
<span id="cb18-4"><a href=""></a><span class="cf">for</span> text <span class="kw">in</span> texts:</span>
<span id="cb18-5"><a href=""></a>    kg <span class="op">=</span> generate_kg(text)</span>
<span id="cb18-6"><a href=""></a>    nodes.append(json.loads(kg)[<span class="st">"nodes"</span>])</span>
<span id="cb18-7"><a href=""></a>    edges.append(json.loads(kg)[<span class="st">"edges"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="node-and-edge-type-candidates" class="slide level3">
<h3>Node and Edge Type Candidates</h3>
<div id="6f39c52a-5659-4540-89ee-16f8d10cddb7" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:12:07.987907Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:12:07.987754Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:12:07.992512Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:12:07.991892Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:12:07.987893Z&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href=""></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb19-2"><a href=""></a></span>
<span id="cb19-3"><a href=""></a><span class="bu">print</span>(</span>
<span id="cb19-4"><a href=""></a>    Counter([node[<span class="st">"type"</span>].upper() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(texts)) </span>
<span id="cb19-5"><a href=""></a>             <span class="cf">for</span> node <span class="kw">in</span> nodes[i]])</span>
<span id="cb19-6"><a href=""></a>)</span>
<span id="cb19-7"><a href=""></a><span class="bu">print</span>(</span>
<span id="cb19-8"><a href=""></a>    Counter([edge[<span class="st">"type"</span>].upper() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(texts)) </span>
<span id="cb19-9"><a href=""></a>             <span class="cf">for</span> edge <span class="kw">in</span> edges[i]])</span>
<span id="cb19-10"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Counter({'PERSON': 11, 'CONCEPT': 4, 'COUNTRY': 2, 'ELEMENT': 2, 'EVENT': 2, 'CHEMICALELEMENT': 2, 'AWARD': 1})
Counter({'DISCOVERED': 5, 'STUDIED': 4, 'AWARD': 3, 'MARRIED': 2, 'RELATED_TO': 2, 'RECEIVED': 2, 'DECEASED': 2, 'BORN_IN': 1, 'VISITED': 1, 'COINED': 1, 'NAMED_AFTER': 1, 'IS': 1, 'MET': 1, 'BROTHER': 1, 'PROPOSED': 1, 'MARRIAGE': 1, 'AFFAIR': 1, 'COLLABORATION': 1})</code></pre>
</div>
</div>
</section>
<section id="section-15" class="slide level3" data-auto-animate="true">
<h3 data-id="quarto-animate-title"></h3>
<div id="771a9f60-c328-4ed8-8838-ea26b774dd2c" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:12:07.993104Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:12:07.992981Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:12:08.019675Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:12:08.018537Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:12:07.993092Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb21" data-code-line-numbers="8,14"><pre class="sourceCode numberSource python number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode python hljs"><span id="cb21-1" class="hljs-ln-code"><a href=""></a><span class="im">from</span> typing <span class="im">import</span> Literal, Optional</span>
<span id="cb21-2" class="hljs-ln-code"><a href=""></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, Field</span>
<span id="cb21-3" class="hljs-ln-code"><a href=""></a></span>
<span id="cb21-4" class="hljs-ln-code"><a href=""></a><span class="kw">class</span> Node(BaseModel):</span>
<span id="cb21-5" class="hljs-ln-code"><a href=""></a>    <span class="co">"""Node of the Knowledge Graph"""</span></span>
<span id="cb21-6" class="hljs-ln-code"><a href=""></a>    <span class="bu">id</span>: <span class="bu">int</span> <span class="op">=</span> Field(</span>
<span id="cb21-7" class="hljs-ln-code"><a href=""></a>        ..., description<span class="op">=</span><span class="st">"Unique identifier of the node starting at zero"</span>)</span>
<span id="cb21-8" class="hljs-ln-code"><a href=""></a>    <span class="bu">type</span>: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Type of the node"</span>)</span>
<span id="cb21-9" class="hljs-ln-code"><a href=""></a>    label: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Label of the node"</span>)</span>
<span id="cb21-10" class="hljs-ln-code"><a href=""></a></span>
<span id="cb21-11" class="hljs-ln-code"><a href=""></a><span class="kw">class</span> Edge(BaseModel):</span>
<span id="cb21-12" class="hljs-ln-code"><a href=""></a>    <span class="co">"""Edge of the Knowledge Graph"""</span></span>
<span id="cb21-13" class="hljs-ln-code"><a href=""></a>    source: <span class="bu">int</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Unique source of the edge"</span>)</span>
<span id="cb21-14" class="hljs-ln-code"><a href=""></a>    target: <span class="bu">int</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Unique target of the edge"</span>)</span>
<span id="cb21-15" class="hljs-ln-code"><a href=""></a>    <span class="bu">type</span>: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Type of the edge"</span>)</span>
<span id="cb21-16" class="hljs-ln-code"><a href=""></a>    label: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Label of the edge"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-16" class="slide level3" data-auto-animate="true">
<h3 data-id="quarto-animate-title"></h3>
<div id="c8f7b78e-eee1-4751-be42-a6d1ef1f24d5" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:12:08.020649Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:12:08.020447Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:12:08.036492Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:12:08.035385Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:12:08.020630Z&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb22" data-code-line-numbers="7-9,15-17"><pre class="sourceCode numberSource python number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode python hljs"><span id="cb22-1" class="hljs-ln-code"><a href=""></a><span class="im">from</span> typing <span class="im">import</span> Literal, Optional</span>
<span id="cb22-2" class="hljs-ln-code"><a href=""></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, Field</span>
<span id="cb22-3" class="hljs-ln-code"><a href=""></a><span class="kw">class</span> Node(BaseModel):</span>
<span id="cb22-4" class="hljs-ln-code"><a href=""></a>    <span class="co">"""Node of the Knowledge Graph"""</span></span>
<span id="cb22-5" class="hljs-ln-code"><a href=""></a>    <span class="bu">id</span>: <span class="bu">int</span> <span class="op">=</span> Field(</span>
<span id="cb22-6" class="hljs-ln-code"><a href=""></a>        ..., description<span class="op">=</span><span class="st">"Unique identifier of the node starting at zero"</span>)</span>
<span id="cb22-7" class="hljs-ln-code"><a href=""></a>    <span class="bu">type</span>: Literal[</span>
<span id="cb22-8" class="hljs-ln-code"><a href=""></a>    <span class="st">"PERSON"</span>, <span class="st">"AWARD"</span>, <span class="st">"DISCOVERY"</span>, <span class="st">"LOCATION"</span>, <span class="st">"OTHER"</span></span>
<span id="cb22-9" class="hljs-ln-code"><a href=""></a>    ] <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Type of the node"</span>)</span>
<span id="cb22-10" class="hljs-ln-code"><a href=""></a>    label: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Label of the node"</span>)</span>
<span id="cb22-11" class="hljs-ln-code"><a href=""></a><span class="kw">class</span> Edge(BaseModel):</span>
<span id="cb22-12" class="hljs-ln-code"><a href=""></a>    <span class="co">"""Edge of the Knowledge Graph"""</span></span>
<span id="cb22-13" class="hljs-ln-code"><a href=""></a>    source: <span class="bu">int</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Unique source of the edge"</span>)</span>
<span id="cb22-14" class="hljs-ln-code"><a href=""></a>    target: <span class="bu">int</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Unique target of the edge"</span>)</span>
<span id="cb22-15" class="hljs-ln-code"><a href=""></a>    <span class="bu">type</span>: Literal[</span>
<span id="cb22-16" class="hljs-ln-code"><a href=""></a>    <span class="st">"DISCOVERED"</span>, <span class="st">"AWARDED"</span>, <span class="st">"INTERPERSONALRELATIONSHIP"</span>, <span class="st">"VISITED"</span>, <span class="st">"OTHER"</span></span>
<span id="cb22-17" class="hljs-ln-code"><a href=""></a>    ] <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Type of the edge"</span>)</span>
<span id="cb22-18" class="hljs-ln-code"><a href=""></a>    label: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"Label of the edge"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-17" class="slide level3">
<h3></h3>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">Chunk 1</a></li><li><a href="#tabset-1-2">Chunk 2</a></li><li><a href="#tabset-1-3">Chunk 3</a></li><li><a href="#tabset-1-4">Chunk 4</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div id="56a9290f-805c-449b-b593-656730088867" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:08.990466Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:08.990313Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:09.057708Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:09.056569Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:08.990453Z&quot;}" data-execution_count="30">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href=""></a><span class="im">from</span> graphviz <span class="im">import</span> Digraph</span>
<span id="cb23-2"><a href=""></a></span>
<span id="cb23-3"><a href=""></a>dot <span class="op">=</span> Digraph()</span>
<span id="cb23-4"><a href=""></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb23-5"><a href=""></a><span class="cf">for</span> node <span class="kw">in</span> nodes[i]:</span>
<span id="cb23-6"><a href=""></a>    <span class="cf">if</span> node[<span class="st">'type'</span>] <span class="op">!=</span> <span class="st">"OTHER"</span>:</span>
<span id="cb23-7"><a href=""></a>        dot.node(<span class="bu">str</span>(node[<span class="st">'id'</span>]), node[<span class="st">'type'</span>]<span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span>node[<span class="st">'label'</span>], shape<span class="op">=</span><span class="st">'circle'</span>, width<span class="op">=</span><span class="st">'1'</span>, height<span class="op">=</span><span class="st">'1'</span>)</span>
<span id="cb23-8"><a href=""></a><span class="cf">for</span> edge <span class="kw">in</span> edges[i]:</span>
<span id="cb23-9"><a href=""></a>    <span class="cf">if</span> edge[<span class="st">"type"</span>] <span class="op">!=</span> <span class="st">"OTHER"</span>: <span class="co">#and nodes[i][edge["source"]]["type"]!= "OTHER" and nodes[i][edge["target"]]["type"]!= "OTHER":</span></span>
<span id="cb23-10"><a href=""></a>        dot.edge(<span class="bu">str</span>(edge[<span class="st">'source'</span>]), <span class="bu">str</span>(edge[<span class="st">'target'</span>]), label<span class="op">=</span>edge[<span class="st">'type'</span>]<span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span> edge[<span class="st">'label'</span>])</span>
<span id="cb23-11"><a href=""></a><span class="bu">print</span>(texts[i])</span>
<span id="cb23-12"><a href=""></a>dot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>When Marie Curie came to the United States for the first time, in May 1921, she had already discovered the elements radium and polonium, coined the term “radio-active” and won the Nobel Prize—twice. But the Polish-born scientist, almost pathologically shy and accustomed to spending most of her time in her Paris laboratory, was stunned by the fanfare that greeted her. In 1898 she indeed identified one of the substances and named it polonium, after her homeland. Five months later, she identified a second element, which the world came to know as radium. Curie described the elements she studied as “radio-active.”</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>
<figure>
<p><img data-src="PyData-Global_files/figure-revealjs/cell-31-output-2.svg"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2">
<div id="0bd529d2-6210-40e1-88c4-b624674c404a" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:09.059242Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:09.058846Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:09.135804Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:09.134898Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:09.059202Z&quot;}" data-execution_count="31">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href=""></a><span class="im">from</span> graphviz <span class="im">import</span> Digraph</span>
<span id="cb25-2"><a href=""></a></span>
<span id="cb25-3"><a href=""></a>dot <span class="op">=</span> Digraph()</span>
<span id="cb25-4"><a href=""></a>i <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb25-5"><a href=""></a><span class="cf">for</span> node <span class="kw">in</span> nodes[i]:</span>
<span id="cb25-6"><a href=""></a>    <span class="cf">if</span> node[<span class="st">'type'</span>] <span class="op">!=</span> <span class="st">"OTHER"</span>:</span>
<span id="cb25-7"><a href=""></a>        dot.node(<span class="bu">str</span>(node[<span class="st">'id'</span>]), node[<span class="st">'type'</span>]<span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span>node[<span class="st">'label'</span>], shape<span class="op">=</span><span class="st">'circle'</span>, width<span class="op">=</span><span class="st">'1'</span>, height<span class="op">=</span><span class="st">'1'</span>)</span>
<span id="cb25-8"><a href=""></a><span class="cf">for</span> edge <span class="kw">in</span> edges[i]:</span>
<span id="cb25-9"><a href=""></a>    <span class="cf">if</span> edge[<span class="st">"type"</span>] <span class="op">!=</span> <span class="st">"OTHER"</span>: <span class="co">#and nodes[i][edge["source"]]["type"]!= "OTHER" and nodes[i][edge["target"]]["type"]!= "OTHER":</span></span>
<span id="cb25-10"><a href=""></a>        dot.edge(<span class="bu">str</span>(edge[<span class="st">'source'</span>]), <span class="bu">str</span>(edge[<span class="st">'target'</span>]), label<span class="op">=</span>edge[<span class="st">'type'</span>]<span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span> edge[<span class="st">'label'</span>])</span>
<span id="cb25-11"><a href=""></a><span class="bu">print</span>(texts[i])</span>
<span id="cb25-12"><a href=""></a>dot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>In 1894, she met Pierre Curie, a 35-year-old physicist at a French technical college who had been studying crystals and magnetism. More than a decade before, he and his brother Jacques had discovered piezoelectricity, the electric charge produced in solid materials under pressure. Pierre was taken by Marie’s uncommon intellect and drive, and he proposed to her. They were married in 1895 in a civil service attended by family and a few friends.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>
<figure>
<p><img data-src="PyData-Global_files/figure-revealjs/cell-32-output-2.svg"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-3">
<div id="354c07da-f0d6-42b3-89c1-44173d4c4347" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:09.137326Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:09.136932Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:09.214961Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:09.213864Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:09.137287Z&quot;}" data-execution_count="32">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href=""></a><span class="im">from</span> graphviz <span class="im">import</span> Digraph</span>
<span id="cb27-2"><a href=""></a></span>
<span id="cb27-3"><a href=""></a>dot <span class="op">=</span> Digraph()</span>
<span id="cb27-4"><a href=""></a>i <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb27-5"><a href=""></a><span class="cf">for</span> node <span class="kw">in</span> nodes[i]:</span>
<span id="cb27-6"><a href=""></a>    <span class="cf">if</span> node[<span class="st">'type'</span>] <span class="op">!=</span> <span class="st">"OTHER"</span>:</span>
<span id="cb27-7"><a href=""></a>        dot.node(<span class="bu">str</span>(node[<span class="st">'id'</span>]), node[<span class="st">'type'</span>]<span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span>node[<span class="st">'label'</span>], shape<span class="op">=</span><span class="st">'circle'</span>, width<span class="op">=</span><span class="st">'1'</span>, height<span class="op">=</span><span class="st">'1'</span>)</span>
<span id="cb27-8"><a href=""></a><span class="cf">for</span> edge <span class="kw">in</span> edges[i]:</span>
<span id="cb27-9"><a href=""></a>    <span class="cf">if</span> edge[<span class="st">"type"</span>] <span class="op">!=</span> <span class="st">"OTHER"</span>: <span class="co">#and nodes[i][edge["source"]]["type"]!= "OTHER" and nodes[i][edge["target"]]["type"]!= "OTHER":</span></span>
<span id="cb27-10"><a href=""></a>        dot.edge(<span class="bu">str</span>(edge[<span class="st">'source'</span>]), <span class="bu">str</span>(edge[<span class="st">'target'</span>]), label<span class="op">=</span>edge[<span class="st">'type'</span>]<span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span> edge[<span class="st">'label'</span>])</span>
<span id="cb27-11"><a href=""></a><span class="bu">print</span>(texts[i])</span>
<span id="cb27-12"><a href=""></a>dot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Both Curies shared the Nobel Prize in physics with Becquerel in 1903. It was the first Nobel to be awarded to a woman. In 1911, rumors spread that Curie was having an affair with the prominent physicist Paul Langevin, a man five years her junior who had been Pierre’s student and had worked closely with Albert Einstein. The front-page coverage of the scandal threatened to overshadow another news story later that year: her second Nobel Prize.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>
<figure>
<p><img data-src="PyData-Global_files/figure-revealjs/cell-33-output-2.svg"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-4">
<div id="798bd635-5b55-4a29-a296-7d16fb7b4a37" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:09.216422Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:09.215959Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:09.295659Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:09.294403Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:09.216391Z&quot;}" data-execution_count="33">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href=""></a><span class="im">from</span> graphviz <span class="im">import</span> Digraph</span>
<span id="cb29-2"><a href=""></a></span>
<span id="cb29-3"><a href=""></a>dot <span class="op">=</span> Digraph()</span>
<span id="cb29-4"><a href=""></a>i <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb29-5"><a href=""></a><span class="cf">for</span> node <span class="kw">in</span> nodes[i]:</span>
<span id="cb29-6"><a href=""></a>    <span class="cf">if</span> node[<span class="st">'type'</span>] <span class="op">!=</span> <span class="st">"OTHER"</span>:</span>
<span id="cb29-7"><a href=""></a>        dot.node(<span class="bu">str</span>(node[<span class="st">'id'</span>]), node[<span class="st">'type'</span>]<span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span>node[<span class="st">'label'</span>], shape<span class="op">=</span><span class="st">'circle'</span>, width<span class="op">=</span><span class="st">'1'</span>, height<span class="op">=</span><span class="st">'1'</span>)</span>
<span id="cb29-8"><a href=""></a><span class="cf">for</span> edge <span class="kw">in</span> edges[i]:</span>
<span id="cb29-9"><a href=""></a>    <span class="cf">if</span> edge[<span class="st">"type"</span>] <span class="op">!=</span> <span class="st">"OTHER"</span>:</span>
<span id="cb29-10"><a href=""></a>        dot.edge(<span class="bu">str</span>(edge[<span class="st">'source'</span>]), <span class="bu">str</span>(edge[<span class="st">'target'</span>]), label<span class="op">=</span>edge[<span class="st">'type'</span>]<span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span> edge[<span class="st">'label'</span>])</span>
<span id="cb29-11"><a href=""></a><span class="bu">print</span>(texts[i])</span>
<span id="cb29-12"><a href=""></a>dot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>This one, in chemistry, was for the discovery of polonium and radium. In her acceptance speech in Stockholm, she paid tribute to her husband but also made clear that her work was independent from his, spelling out their separate contributions and describing the discoveries she had made after his death.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>
<figure>
<p><img data-src="PyData-Global_files/figure-revealjs/cell-34-output-2.svg"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="section-18" class="slide level3">
<h3></h3>
<div id="a2a77d56-bcd5-433c-81a6-c6e6fa4f2b0f" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:09.297336Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:09.296911Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:09.321872Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:09.321011Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:09.297296Z&quot;}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href=""></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb31-2"><a href=""></a></span>
<span id="cb31-3"><a href=""></a>df_nodes <span class="op">=</span> pd.DataFrame(nodes[<span class="dv">0</span>])</span>
<span id="cb31-4"><a href=""></a>df_edges <span class="op">=</span> pd.DataFrame({</span>
<span id="cb31-5"><a href=""></a>    <span class="st">'source'</span>: [nodes[<span class="dv">0</span>][edge[<span class="st">'source'</span>]][<span class="st">'label'</span>] <span class="cf">for</span> edge <span class="kw">in</span> edges[<span class="dv">0</span>]],</span>
<span id="cb31-6"><a href=""></a>    <span class="st">'target'</span>: [nodes[<span class="dv">0</span>][edge[<span class="st">'target'</span>]][<span class="st">'label'</span>] <span class="cf">for</span> edge <span class="kw">in</span> edges[<span class="dv">0</span>]],</span>
<span id="cb31-7"><a href=""></a>    <span class="st">'type'</span>: [edge[<span class="st">'type'</span>] <span class="cf">for</span> edge <span class="kw">in</span> edges[<span class="dv">0</span>]],</span>
<span id="cb31-8"><a href=""></a>    <span class="st">'label'</span>: [edge[<span class="st">'label'</span>] <span class="cf">for</span> edge <span class="kw">in</span> edges[<span class="dv">0</span>]]</span>
<span id="cb31-9"><a href=""></a>})</span>
<span id="cb31-10"><a href=""></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">len</span>(texts)):</span>
<span id="cb31-11"><a href=""></a>    df_nodes_aux <span class="op">=</span> pd.DataFrame({</span>
<span id="cb31-12"><a href=""></a>        <span class="st">'id'</span>: [node[<span class="st">'id'</span>]<span class="op">+</span><span class="bu">len</span>(df_nodes) <span class="cf">for</span> node <span class="kw">in</span> nodes[i]],</span>
<span id="cb31-13"><a href=""></a>        <span class="st">'label'</span>: [node[<span class="st">'label'</span>] <span class="cf">for</span> node <span class="kw">in</span> nodes[i]],</span>
<span id="cb31-14"><a href=""></a>        <span class="st">'type'</span>: [node[<span class="st">'type'</span>] <span class="cf">for</span> node <span class="kw">in</span> nodes[i]]</span>
<span id="cb31-15"><a href=""></a>    })</span>
<span id="cb31-16"><a href=""></a>    df_edges_aux <span class="op">=</span> pd.DataFrame({</span>
<span id="cb31-17"><a href=""></a>        <span class="st">'source'</span>: [nodes[i][edge[<span class="st">'source'</span>]][<span class="st">'label'</span>] <span class="cf">for</span> edge <span class="kw">in</span> edges[i]],</span>
<span id="cb31-18"><a href=""></a>        <span class="st">'target'</span>: [nodes[i][edge[<span class="st">'target'</span>]][<span class="st">'label'</span>] <span class="cf">for</span> edge <span class="kw">in</span> edges[i]],</span>
<span id="cb31-19"><a href=""></a>        <span class="st">'type'</span>: [edge[<span class="st">'type'</span>] <span class="cf">for</span> edge <span class="kw">in</span> edges[i]],</span>
<span id="cb31-20"><a href=""></a>        <span class="st">'label'</span>: [edge[<span class="st">'label'</span>] <span class="cf">for</span> edge <span class="kw">in</span> edges[i]]</span>
<span id="cb31-21"><a href=""></a>    })</span>
<span id="cb31-22"><a href=""></a>    df_nodes <span class="op">=</span> pd.concat([df_nodes, df_nodes_aux])</span>
<span id="cb31-23"><a href=""></a>    df_edges <span class="op">=</span> pd.concat([df_edges, df_edges_aux])</span>
<span id="cb31-24"><a href=""></a></span>
<span id="cb31-25"><a href=""></a>df_nodes<span class="op">=</span>df_nodes[df_nodes[<span class="st">"type"</span>]<span class="op">!=</span><span class="st">"OTHER"</span>].drop_duplicates(subset<span class="op">=</span><span class="st">"label"</span>)</span>
<span id="cb31-26"><a href=""></a>df_edges<span class="op">=</span>df_edges[df_edges[<span class="st">"type"</span>]<span class="op">!=</span><span class="st">"OTHER"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="insert-nodes-to-the-graph-db" class="slide level3">
<h3>Insert nodes to the graph db</h3>
<div id="2088d633-7138-4d24-9f78-7226102630a4" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:09.323152Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:09.322786Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:09.637995Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:09.636676Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:09.323125Z&quot;}" data-execution_count="35">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href=""></a><span class="im">import</span> kuzu</span>
<span id="cb32-2"><a href=""></a></span>
<span id="cb32-3"><a href=""></a>db <span class="op">=</span> kuzu.Database()</span>
<span id="cb32-4"><a href=""></a>conn <span class="op">=</span> kuzu.Connection(db)</span>
<span id="cb32-5"><a href=""></a><span class="co"># create schema</span></span>
<span id="cb32-6"><a href=""></a>conn.execute(<span class="st">"CREATE NODE TABLE Person(name STRING, PRIMARY KEY (name))"</span>)<span class="op">;</span></span>
<span id="cb32-7"><a href=""></a>conn.execute(<span class="st">"CREATE NODE TABLE Award(name STRING, PRIMARY KEY (name))"</span>)<span class="op">;</span></span>
<span id="cb32-8"><a href=""></a>conn.execute(<span class="st">"CREATE NODE TABLE Discovery(name STRING, PRIMARY KEY (name))"</span>)<span class="op">;</span></span>
<span id="cb32-9"><a href=""></a>conn.execute(<span class="st">"CREATE NODE TABLE Location(name STRING, PRIMARY KEY (name))"</span>)<span class="op">;</span></span>
<span id="cb32-10"><a href=""></a><span class="co"># copy from dataframes</span></span>
<span id="cb32-11"><a href=""></a>df_nodes_person <span class="op">=</span> df_nodes[df_nodes[<span class="st">"type"</span>] <span class="op">==</span> <span class="st">"PERSON"</span>][[<span class="st">"label"</span>]]</span>
<span id="cb32-12"><a href=""></a>df_nodes_award <span class="op">=</span> df_nodes[df_nodes[<span class="st">"type"</span>] <span class="op">==</span> <span class="st">"AWARD"</span>][[<span class="st">"label"</span>]]</span>
<span id="cb32-13"><a href=""></a>df_nodes_discovery <span class="op">=</span> df_nodes[df_nodes[<span class="st">"type"</span>] <span class="op">==</span> <span class="st">"DISCOVERY"</span>][[<span class="st">"label"</span>]]</span>
<span id="cb32-14"><a href=""></a>df_nodes_location <span class="op">=</span> df_nodes[df_nodes[<span class="st">"type"</span>] <span class="op">==</span> <span class="st">"LOCATION"</span>][[<span class="st">"label"</span>]]</span>
<span id="cb32-15"><a href=""></a>conn.execute(<span class="st">"COPY Person FROM df_nodes_person"</span>)<span class="op">;</span></span>
<span id="cb32-16"><a href=""></a>conn.execute(<span class="st">"COPY Award FROM df_nodes_award"</span>)<span class="op">;</span></span>
<span id="cb32-17"><a href=""></a>conn.execute(<span class="st">"COPY Discovery FROM df_nodes_discovery"</span>)<span class="op">;</span></span>
<span id="cb32-18"><a href=""></a>conn.execute(<span class="st">"COPY Location FROM df_nodes_location"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-for-nodes" class="slide level3">
<h3>Check for nodes</h3>
<div id="e358d2df-542b-4010-87aa-b67185efee89" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:09.639744Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:09.639299Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:09.668846Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:09.667833Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:09.639698Z&quot;}" data-execution_count="36">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href=""></a>result <span class="op">=</span> conn.execute(<span class="st">"MATCH (person:Person) RETURN person.name;"</span>)</span>
<span id="cb33-2"><a href=""></a><span class="cf">while</span> result.has_next():</span>
<span id="cb33-3"><a href=""></a>    <span class="bu">print</span>(result.get_next())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['Marie Curie']
['Pierre Curie']
['Henri Becquerel']
['Paul Langevin']</code></pre>
</div>
</div>
</section>
<section id="insert-edges-to-the-graph-db" class="slide level3">
<h3>Insert edges to the graph db</h3>
<div id="18916909-a458-4daa-818a-01c4f0a23bbf" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:09.670500Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:09.670074Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:09.714192Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:09.713630Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:09.670458Z&quot;}" data-scrolled="true" data-execution_count="37">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href=""></a>conn.execute(<span class="st">"CREATE REL TABLE Awarded(FROM Person TO Award)"</span>)<span class="op">;</span> <span class="co"># create schema</span></span>
<span id="cb35-2"><a href=""></a>conn.execute(<span class="st">"CREATE REL TABLE Discovered(FROM Person TO Discovery)"</span>)<span class="op">;</span></span>
<span id="cb35-3"><a href=""></a>conn.execute(<span class="st">"CREATE REL TABLE Interpersonal_Relationship(FROM Person TO Person)"</span>)<span class="op">;</span></span>
<span id="cb35-4"><a href=""></a>conn.execute(<span class="st">"CREATE REL TABLE Visited(FROM Person TO Location)"</span>)<span class="op">;</span></span>
<span id="cb35-5"><a href=""></a><span class="kw">def</span> my_func(edge_type: <span class="bu">str</span>, source: <span class="bu">str</span>, target: <span class="bu">str</span>):</span>
<span id="cb35-6"><a href=""></a>    mask1 <span class="op">=</span> [a <span class="kw">in</span> <span class="bu">list</span>(df_nodes[df_nodes[<span class="st">"type"</span>] <span class="op">==</span> source][<span class="st">'label'</span>]) <span class="cf">for</span> a <span class="kw">in</span> df_edges[df_edges[<span class="st">"type"</span>] <span class="op">==</span> edge_type][<span class="st">"source"</span>]]</span>
<span id="cb35-7"><a href=""></a>    mask2 <span class="op">=</span> [a <span class="kw">in</span> <span class="bu">list</span>(df_nodes[df_nodes[<span class="st">"type"</span>] <span class="op">==</span> target][<span class="st">'label'</span>]) <span class="cf">for</span> a <span class="kw">in</span> df_edges[df_edges[<span class="st">"type"</span>] <span class="op">==</span> edge_type][<span class="st">"target"</span>]]</span>
<span id="cb35-8"><a href=""></a>    mask <span class="op">=</span> [a <span class="op">&amp;</span> b <span class="cf">for</span> a,b <span class="kw">in</span> <span class="bu">zip</span>(mask1,mask2)]</span>
<span id="cb35-9"><a href=""></a>    <span class="cf">return</span> df_edges[df_edges[<span class="st">"type"</span>] <span class="op">==</span> edge_type][mask]</span>
<span id="cb35-10"><a href=""></a>df_edges_awarded <span class="op">=</span> my_func(<span class="st">"AWARDED"</span>, <span class="st">"PERSON"</span>, <span class="st">"AWARD"</span>)[[<span class="st">"source"</span>, <span class="st">"target"</span>]]</span>
<span id="cb35-11"><a href=""></a>df_edges_discovered <span class="op">=</span> my_func(<span class="st">"DISCOVERED"</span>, <span class="st">"PERSON"</span>, <span class="st">"DISCOVERY"</span>)[[<span class="st">"source"</span>, <span class="st">"target"</span>]]</span>
<span id="cb35-12"><a href=""></a>df_edges_visited <span class="op">=</span> my_func(<span class="st">"VISITED"</span>, <span class="st">"PERSON"</span>, <span class="st">"LOCATION"</span>)[[<span class="st">"source"</span>, <span class="st">"target"</span>]]</span>
<span id="cb35-13"><a href=""></a>df_edges_interpersonal_relationship <span class="op">=</span> my_func(<span class="st">"INTERPERSONALRELATIONSHIP"</span>, <span class="st">"PERSON"</span>, <span class="st">"PERSON"</span>)[[<span class="st">"source"</span>, <span class="st">"target"</span>]]</span>
<span id="cb35-14"><a href=""></a>conn.execute(<span class="st">"COPY Discovered FROM df_edges_discovered"</span>)<span class="op">;</span> <span class="co"># copy from dataframes</span></span>
<span id="cb35-15"><a href=""></a>conn.execute(<span class="st">"COPY Awarded FROM df_edges_awarded"</span>)<span class="op">;</span></span>
<span id="cb35-16"><a href=""></a>conn.execute(<span class="st">"COPY Visited FROM df_edges_visited"</span>)<span class="op">;</span></span>
<span id="cb35-17"><a href=""></a>conn.execute(<span class="st">"COPY Interpersonal_Relationship FROM df_edges_interpersonal_relationship"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-for-edges" class="slide level3">
<h3>Check for edges</h3>
<div id="92ac5a3f-d0ee-456c-90de-65e75a9c2214" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:09.715153Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:09.714835Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:09.723246Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:09.722764Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:09.715133Z&quot;}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href=""></a>result <span class="op">=</span> conn.execute(<span class="st">"MATCH (a)-[:DISCOVERED]-&gt;(c) RETURN a.name, c.name;"</span>)</span>
<span id="cb36-2"><a href=""></a><span class="cf">while</span> result.has_next():</span>
<span id="cb36-3"><a href=""></a>    <span class="bu">print</span>(result.get_next())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['Marie Curie', 'Polonium']
['Marie Curie', 'Radium']
['Pierre Curie', 'Piezoelectricity']</code></pre>
</div>
</div>
</section>
</section>
<section>
<section id="kg-based-agents" class="title-slide slide level1 center">
<h1>KG-based Agents</h1>

</section>
<section id="section-19" class="slide level3 nostretch">
<h3></h3>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="./assets/KG-Agent.jpg" title="Knowledge Graph Based Agent" class="quarto-figure quarto-figure-center" style="width:80.0%"></p>
</figure>
</div>
</section>
<section id="tools" class="title-slide slide level2 center">
<h2>Tools</h2>

</section>
<section id="tool-query-checker" class="slide level3">
<h3>Tool: Query Checker</h3>
<div id="aaa6d802-dfc8-42ea-9d16-27a7dd737360" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:09.724036Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:09.723835Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:09.729384Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:09.728893Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:09.724017Z&quot;}" data-execution_count="39">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href=""></a><span class="kw">def</span> build_kuzu_query_checker_prompt(cypher_query):</span>
<span id="cb38-2"><a href=""></a>    <span class="cf">return</span> (</span>
<span id="cb38-3"><a href=""></a>    <span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>cypher_query<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb38-4"><a href=""></a>    <span class="st">"Double check the Kùzu dialect of Cypher for the query above "</span></span>
<span id="cb38-5"><a href=""></a>    <span class="st">"for common mistakes, including:</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb38-6"><a href=""></a>    <span class="st">"- Using the correct number of arguments for functions</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb38-7"><a href=""></a>    <span class="st">"- Casting to the correct data type</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb38-8"><a href=""></a>    <span class="st">"- Do not omit the relationship pattern.</span><span class="ch">\n</span><span class="st">"</span> </span>
<span id="cb38-9"><a href=""></a>    <span class="st">"- Always use `()-[]-&gt;()` instead of `()-&gt;()`.</span><span class="ch">\n\n</span><span class="st">"</span></span>
<span id="cb38-10"><a href=""></a>    <span class="st">"If there are any of the above mistakes, rewrite the query. "</span></span>
<span id="cb38-11"><a href=""></a>    <span class="st">"If there are no mistakes, just reproduce the original query.</span><span class="ch">\n\n</span><span class="st">"</span></span>
<span id="cb38-12"><a href=""></a>    <span class="st">"Output the final Kùzu Cypher query only.</span><span class="ch">\n\n</span><span class="st">"</span></span>
<span id="cb38-13"><a href=""></a>    <span class="st">"Kùzu Cypher Query: "</span></span>
<span id="cb38-14"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tool-query-checker-1" class="slide level3">
<h3>Tool: Query Checker</h3>
<div id="43c3527a-7845-4ed6-9667-6429bf367653" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:09.730180Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:09.729983Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:10.320419Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:10.319823Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:09.730161Z&quot;}" data-execution_count="40">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href=""></a><span class="kw">def</span> query_checker_tool(cypher_query):</span>
<span id="cb39-2"><a href=""></a>    user_prompt <span class="op">=</span> build_kuzu_query_checker_prompt(cypher_query)</span>
<span id="cb39-3"><a href=""></a>    response <span class="op">=</span> llm.create_chat_completion(</span>
<span id="cb39-4"><a href=""></a>        messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: user_prompt}]</span>
<span id="cb39-5"><a href=""></a>    )</span>
<span id="cb39-6"><a href=""></a>    <span class="cf">return</span> response[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"content"</span>]</span>
<span id="cb39-7"><a href=""></a></span>
<span id="cb39-8"><a href=""></a></span>
<span id="cb39-9"><a href=""></a>query_checker_tool(</span>
<span id="cb39-10"><a href=""></a><span class="st">"MATCH (p:Person)-[:Discovered]-&lt;(:Discovery {name: 'Polonium'})</span><span class="ch">\n</span><span class="st">RETURN *"</span></span>
<span id="cb39-11"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>"MATCH (p:Person)-[:Discovered]-&gt;(d:Discovery {name: 'Polonium'})\nRETURN *"</code></pre>
</div>
</div>
</section>
<section id="tool-query-generator-executor" class="slide level3">
<h3>Tool: Query Generator + Executor</h3>
<div id="de649793-9675-4092-8822-69ed8e7ff7c6" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:11.051765Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:11.051633Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:11.070447Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:11.069811Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:11.051752Z&quot;}" data-execution_count="42">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href=""></a><span class="im">from</span> langchain_community.graphs <span class="im">import</span> KuzuGraph</span>
<span id="cb41-2"><a href=""></a></span>
<span id="cb41-3"><a href=""></a>graph_db_schema <span class="op">=</span> KuzuGraph(db).get_schema</span>
<span id="cb41-4"><a href=""></a><span class="bu">print</span>(graph_db_schema)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Node properties: [{'properties': [('name', 'STRING')], 'label': 'Person'}, {'properties': [('name', 'STRING')], 'label': 'Discovery'}, {'properties': [('name', 'STRING')], 'label': 'Award'}, {'properties': [('name', 'STRING')], 'label': 'Location'}]
Relationships properties: [{'properties': [], 'label': 'Awarded'}, {'properties': [], 'label': 'Discovered'}, {'properties': [], 'label': 'Interpersonal_Relationship'}, {'properties': [], 'label': 'Visited'}]
Relationships: ['(:Person)-[:Awarded]-&gt;(:Award)', '(:Person)-[:Discovered]-&gt;(:Discovery)', '(:Person)-[:Interpersonal_Relationship]-&gt;(:Person)', '(:Person)-[:Visited]-&gt;(:Location)']
</code></pre>
</div>
</div>
</section>
<section id="tool-query-generator-executor-1" class="slide level3">
<h3>Tool: Query Generator + Executor</h3>
<div id="72cf56ea-4acb-4828-ad64-054eed28c01e" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:11.071255Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:11.071062Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:11.075968Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:11.075088Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:11.071236Z&quot;}" data-execution_count="43">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href=""></a><span class="kw">def</span> build_kuzu_prompt(query, graph_db_schema<span class="op">=</span>graph_db_schema):</span>
<span id="cb43-2"><a href=""></a>    <span class="cf">return</span> <span class="st">"""Task: Generate Kùzu Cypher statement to query a graph database.</span></span>
<span id="cb43-3"><a href=""></a></span>
<span id="cb43-4"><a href=""></a><span class="st">Instructions:</span></span>
<span id="cb43-5"><a href=""></a><span class="st">Generate the Kùzu dialect of Cypher with the following rules in mind:</span></span>
<span id="cb43-6"><a href=""></a><span class="st">1. Do not omit the relationship pattern. Always use `()-[]-&gt;()` instead of `()-&gt;()`.</span></span>
<span id="cb43-7"><a href=""></a><span class="st">2. Do not include triple backticks ``` in your response. Return only Cypher.</span></span>
<span id="cb43-8"><a href=""></a><span class="st">3. Do not return any notes or comments in your response.</span></span>
<span id="cb43-9"><a href=""></a></span>
<span id="cb43-10"><a href=""></a><span class="st">Use only the provided relationship types and properties in the schema.</span></span>
<span id="cb43-11"><a href=""></a><span class="st">Do not use any other relationship types or properties that are not provided.</span></span>
<span id="cb43-12"><a href=""></a><span class="st">Schema:</span><span class="ch">\n</span><span class="st">"""</span> <span class="op">+</span> graph_db_schema <span class="op">+</span> <span class="st">"""</span></span>
<span id="cb43-13"><a href=""></a><span class="ch">\n</span><span class="st">Example:</span></span>
<span id="cb43-14"><a href=""></a><span class="st">The question is:</span><span class="ch">\n</span><span class="st">"Which songs does the load album have?"</span></span>
<span id="cb43-15"><a href=""></a><span class="st">MATCH (a:ALBUM {name: 'Load'})&lt;-[:IN_ALBUM]-(s:SONG) RETURN s.name</span></span>
<span id="cb43-16"><a href=""></a><span class="st">Note: Do not include any explanations or apologies in your responses.</span></span>
<span id="cb43-17"><a href=""></a><span class="st">Do not respond to any questions that might ask anything else than for you to construct a Cypher statement.</span></span>
<span id="cb43-18"><a href=""></a><span class="st">Do not include any text except the generated Cypher statement.</span></span>
<span id="cb43-19"><a href=""></a></span>
<span id="cb43-20"><a href=""></a><span class="st">The question is:</span><span class="ch">\n</span><span class="st">"""</span> <span class="op">+</span> query</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tool-query-generator-executor-2" class="slide level3">
<h3>Tool: Query Generator + Executor</h3>
<div id="f1d8b119-427b-4807-99a4-f7b92ee7e4e1" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:11.076660Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:11.076475Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:12.845207Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:12.844242Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:11.076641Z&quot;}" data-execution_count="44">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href=""></a><span class="kw">def</span> query_generator_tool(query):</span>
<span id="cb44-2"><a href=""></a>    user_prompt <span class="op">=</span> build_kuzu_prompt(query)</span>
<span id="cb44-3"><a href=""></a>    output <span class="op">=</span> llm.create_chat_completion(</span>
<span id="cb44-4"><a href=""></a>        messages <span class="op">=</span> [{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: user_prompt}]</span>
<span id="cb44-5"><a href=""></a>    )</span>
<span id="cb44-6"><a href=""></a>    cypher_query <span class="op">=</span> output[<span class="st">'choices'</span>][<span class="dv">0</span>][<span class="st">'message'</span>][<span class="st">'content'</span>]</span>
<span id="cb44-7"><a href=""></a>    cypher_query <span class="op">=</span> query_checker_tool(cypher_query)</span>
<span id="cb44-8"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\x1b</span><span class="ss">[33m Cypher query: </span><span class="sc">{</span>cypher_query<span class="sc">}</span><span class="ss"> </span><span class="ch">\x1b</span><span class="ss">[0m"</span>)</span>
<span id="cb44-9"><a href=""></a>    response <span class="op">=</span> conn.execute(<span class="ss">f"</span><span class="sc">{</span>cypher_query<span class="sc">}</span><span class="ss">"</span>)<span class="op">;</span></span>
<span id="cb44-10"><a href=""></a>    df <span class="op">=</span> response.get_as_pl()</span>
<span id="cb44-11"><a href=""></a>    col_name <span class="op">=</span> df.columns[<span class="dv">0</span>]</span>
<span id="cb44-12"><a href=""></a>    _values <span class="op">=</span> df[col_name].to_list()</span>
<span id="cb44-13"><a href=""></a>    <span class="cf">return</span> <span class="ss">f"[</span><span class="sc">{</span>col_name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>_values<span class="sc">}</span><span class="ss">]"</span></span>
<span id="cb44-14"><a href=""></a>query_generator_tool(<span class="st">"What discovery is Marie Curie famous for?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Cypher query: MATCH (p:Person {name: 'Marie Curie'})-[:Discovered]-&gt;(d:Discovery) RETURN d.name </code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>"[d.name: ['Radium', 'Polonium']]"</code></pre>
</div>
</div>
</section>
<section id="tool-conversational-response" class="slide level3">
<h3>Tool: Conversational Response</h3>
<div id="90248226-d0af-4e29-80ea-5094bcd973cb" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:14.378253Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:14.378117Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:14.381399Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:14.380807Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:14.378240Z&quot;}" data-execution_count="46">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href=""></a><span class="kw">def</span> conversational_response(text):</span>
<span id="cb47-2"><a href=""></a>    <span class="cf">return</span> text</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

<section id="react-agent" class="title-slide slide level2 center">
<h2>ReAct agent</h2>
<div id="c63a7f07-211b-485c-9bef-ae4b463dd781" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:14.403427Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:14.403280Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:14.416087Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:14.415195Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:14.403413Z&quot;}" data-execution_count="48">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href=""></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, Field</span>
<span id="cb48-2"><a href=""></a></span>
<span id="cb48-3"><a href=""></a></span>
<span id="cb48-4"><a href=""></a><span class="kw">class</span> Reason_and_Act(BaseModel):</span>
<span id="cb48-5"><a href=""></a>    Scratchpad: <span class="bu">str</span> <span class="op">=</span> Field(</span>
<span id="cb48-6"><a href=""></a>        ...,</span>
<span id="cb48-7"><a href=""></a>        description<span class="op">=</span><span class="st">"Information from the Observation useful to answer the question"</span>,</span>
<span id="cb48-8"><a href=""></a>    )</span>
<span id="cb48-9"><a href=""></a>    Thought: <span class="bu">str</span> <span class="op">=</span> Field(</span>
<span id="cb48-10"><a href=""></a>        ...,</span>
<span id="cb48-11"><a href=""></a>        description<span class="op">=</span><span class="st">"It describes your thoughts about the question you have been asked"</span>,</span>
<span id="cb48-12"><a href=""></a>    )</span>
<span id="cb48-13"><a href=""></a>    Action: Literal[<span class="st">"conversational_response"</span>, <span class="st">"query_generator"</span>, <span class="st">"query_checker"</span>] <span class="op">=</span> (</span>
<span id="cb48-14"><a href=""></a>        Field(..., description<span class="op">=</span><span class="st">"The action to take"</span>)</span>
<span id="cb48-15"><a href=""></a>    )</span>
<span id="cb48-16"><a href=""></a>    Action_Input: <span class="bu">str</span> <span class="op">=</span> Field(..., description<span class="op">=</span><span class="st">"The arguments of the Action."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="react-agent-1" class="slide level3">
<h3>ReAct Agent</h3>
<div id="3bc045f5-884e-4f9e-b219-7ce3902bfa9f" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:14.416867Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:14.416673Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:14.434858Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:14.433763Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:14.416848Z&quot;}" data-execution_count="49">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href=""></a><span class="kw">class</span> Final_Answer(BaseModel):</span>
<span id="cb49-2"><a href=""></a>    Scratchpad: <span class="bu">str</span> <span class="op">=</span> Field(</span>
<span id="cb49-3"><a href=""></a>        ...,</span>
<span id="cb49-4"><a href=""></a>        description<span class="op">=</span><span class="st">"Information from the Observation useful to answer the question"</span>,</span>
<span id="cb49-5"><a href=""></a>    )</span>
<span id="cb49-6"><a href=""></a>    Final_Answer: <span class="bu">str</span> <span class="op">=</span> Field(</span>
<span id="cb49-7"><a href=""></a>        ..., description<span class="op">=</span><span class="st">"Answer to the question grounded on the Observation"</span></span>
<span id="cb49-8"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="react-agent-2" class="slide level3">
<h3>ReAct Agent</h3>
<div id="9e26ca92-b4dc-4fea-997c-3c93fc283be4" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:14.436306Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:14.435844Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:14.449119Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:14.447983Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:14.436271Z&quot;}" data-execution_count="50">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href=""></a><span class="kw">class</span> Decision(BaseModel):</span>
<span id="cb50-2"><a href=""></a>    Decision: Reason_and_Act <span class="op">|</span> Final_Answer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="react-agent-3" class="slide level3">
<h3>ReAct Agent</h3>
<div id="c26d9b60-dd92-47be-a36f-0593a71c2822" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:14.450772Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:14.450282Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:14.464308Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:14.463200Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:14.450733Z&quot;}" data-execution_count="51">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href=""></a><span class="im">from</span> outlines <span class="im">import</span> generate, models</span>
<span id="cb51-2"><a href=""></a><span class="im">from</span> outlines.fsm.json_schema <span class="im">import</span> build_regex_from_schema, convert_json_schema_to_str</span>
<span id="cb51-3"><a href=""></a></span>
<span id="cb51-4"><a href=""></a>model <span class="op">=</span> models.LlamaCpp(llm)</span>
<span id="cb51-5"><a href=""></a>schema_str <span class="op">=</span> convert_json_schema_to_str(json_schema<span class="op">=</span>Decision.schema_json())</span>
<span id="cb51-6"><a href=""></a>regex_str <span class="op">=</span> build_regex_from_schema(schema_str)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="react-agent-4" class="slide level3">
<h3>ReAct Agent</h3>
<div id="707a820d-2bcb-48de-953c-7e356a0793d9" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:14.466112Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:14.465584Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:14.477410Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:14.476393Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:14.466072Z&quot;}" data-execution_count="52">
<div class="sourceCode cell-code" id="cb52" data-code-line-numbers="1-27|6-7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href=""></a><span class="kw">def</span> generate_hermes_prompt(question, schema<span class="op">=</span><span class="st">""</span>):</span>
<span id="cb52-2"><a href=""></a>    <span class="cf">return</span> (</span>
<span id="cb52-3"><a href=""></a>        <span class="st">"&lt;|im_start|&gt;system</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb52-4"><a href=""></a>        <span class="st">"You are a world class AI model who answers questions in JSON with correct Pydantic schema."</span></span>
<span id="cb52-5"><a href=""></a>        <span class="ss">f"</span><span class="ch">\n</span><span class="ss">Here's the JSON schema you must adhere to:</span><span class="ch">\n</span><span class="ss">&lt;schema&gt;</span><span class="ch">\n</span><span class="sc">{</span>schema<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/schema&gt;</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb52-6"><a href=""></a>        <span class="st">"You run in a loop of Scratchpad, Thought, Action, Action Input, PAUSE, Observation."</span></span>
<span id="cb52-7"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">At the end of the loop you output a Final Answer. "</span></span>
<span id="cb52-8"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">- Use Scratchpad to store the information from the observation useful to answer the question"</span></span>
<span id="cb52-9"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">- Use Thought to describe your thoughts about the question you have been asked "</span></span>
<span id="cb52-10"><a href=""></a>        <span class="st">"and reflect carefully about the Observation if it exists. "</span></span>
<span id="cb52-11"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">- Use Action to run one of the actions available to you. "</span></span>
<span id="cb52-12"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">- Use Action Input to input the arguments of the selected action - then return PAUSE. "</span></span>
<span id="cb52-13"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">- Observation will be the result of running those actions. "</span></span>
<span id="cb52-14"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">Your available actions are:</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb52-15"><a href=""></a>        <span class="st">"query_generator:</span><span class="ch">\n</span><span class="st">"</span> </span>
<span id="cb52-16"><a href=""></a>        <span class="st">"e.g. query_generator: Who is Marie Curie related to?</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb52-17"><a href=""></a>        <span class="st">"Returns a detailed and correct Kùzu Cypher query</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb52-18"><a href=""></a>        <span class="st">"query_checker:</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb52-19"><a href=""></a>        <span class="st">"e.g. query_checker: MATCH (a:ALBUM {name: 'The Black Album'})&lt;-[:IN_ALBUM]-(s:SONG) RETURN COUNT(s)</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb52-20"><a href=""></a>        <span class="st">"Returns a detailed and correct Kùzu Cypher query after double checking the query for common mistakes</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb52-21"><a href=""></a>        <span class="st">"conversational_reponse:"</span></span>
<span id="cb52-22"><a href=""></a>        <span class="st">"e.g. conversational_response: Hi!</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb52-23"><a href=""></a>        <span class="st">"Returns a conversational response to the user</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb52-24"><a href=""></a>        <span class="st">"DO NOT TRY TO GUESS THE ANSWER. Begin! &lt;|im_end|&gt;"</span></span>
<span id="cb52-25"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">&lt;|im_start|&gt;user</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> question <span class="op">+</span> <span class="st">"&lt;|im_end|&gt;"</span></span>
<span id="cb52-26"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">&lt;|im_start|&gt;assistant</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb52-27"><a href=""></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="react-agent-5" class="slide level3">
<h3>ReAct Agent</h3>
<div id="7f8ffd64-4697-49f7-a0d7-f0968fc7632d" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:14.496174Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:14.495664Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:14.507173Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:14.506024Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:14.496133Z&quot;}" data-execution_count="54">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href=""></a><span class="kw">class</span> ChatBot:</span>
<span id="cb53-2"><a href=""></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, prompt<span class="op">=</span><span class="st">""</span>):</span>
<span id="cb53-3"><a href=""></a>        <span class="va">self</span>.prompt <span class="op">=</span> prompt</span>
<span id="cb53-4"><a href=""></a></span>
<span id="cb53-5"><a href=""></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, user_prompt):</span>
<span id="cb53-6"><a href=""></a>        <span class="va">self</span>.prompt <span class="op">+=</span> user_prompt</span>
<span id="cb53-7"><a href=""></a>        result <span class="op">=</span> <span class="va">self</span>.execute()</span>
<span id="cb53-8"><a href=""></a>        <span class="cf">return</span> result</span>
<span id="cb53-9"><a href=""></a>        </span>
<span id="cb53-10"><a href=""></a>    <span class="kw">def</span> execute(<span class="va">self</span>):</span>
<span id="cb53-11"><a href=""></a>        generator <span class="op">=</span> generate.regex(model, regex_str)</span>
<span id="cb53-12"><a href=""></a>        result <span class="op">=</span> generator(<span class="va">self</span>.prompt, max_tokens<span class="op">=</span><span class="dv">1024</span>, temperature<span class="op">=</span><span class="dv">0</span>, seed<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb53-13"><a href=""></a>        <span class="cf">return</span> result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="react-agent-6" class="slide level3">
<h3>ReAct Agent</h3>
<div id="d426a6e7-11f2-4d92-ae90-d4b521d63a1a" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T13:13:14.509062Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T13:13:14.508555Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T13:13:14.528113Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T13:13:14.527000Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T13:13:14.509022Z&quot;}" data-execution_count="55">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href=""></a><span class="im">import</span> json</span>
<span id="cb54-2"><a href=""></a></span>
<span id="cb54-3"><a href=""></a><span class="kw">def</span> query(question, max_turns<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb54-4"><a href=""></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-5"><a href=""></a>    next_prompt <span class="op">=</span> (</span>
<span id="cb54-6"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">&lt;|im_start|&gt;user</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> question <span class="op">+</span> <span class="st">"&lt;|im_end|&gt;"</span></span>
<span id="cb54-7"><a href=""></a>        <span class="st">"</span><span class="ch">\n</span><span class="st">&lt;|im_start|&gt;assistant</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb54-8"><a href=""></a>    )</span>
<span id="cb54-9"><a href=""></a>    previous_actions <span class="op">=</span> []</span>
<span id="cb54-10"><a href=""></a>    <span class="cf">while</span> i <span class="op">&lt;</span> max_turns:</span>
<span id="cb54-11"><a href=""></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-12"><a href=""></a>        prompt <span class="op">=</span> generate_hermes_prompt(question<span class="op">=</span>question, schema<span class="op">=</span>Decision.schema_json())</span>
<span id="cb54-13"><a href=""></a>        bot <span class="op">=</span> ChatBot(prompt<span class="op">=</span>prompt)</span>
<span id="cb54-14"><a href=""></a>        result <span class="op">=</span> bot(next_prompt)</span>
<span id="cb54-15"><a href=""></a>        json_result <span class="op">=</span> json.loads(result)[<span class="st">'Decision'</span>]</span>
<span id="cb54-16"><a href=""></a>        <span class="cf">if</span> <span class="st">"Final_Answer"</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">list</span>(json_result.keys()):</span>
<span id="cb54-17"><a href=""></a>            scratchpad <span class="op">=</span> json_result[<span class="st">'Scratchpad'</span>] <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb54-18"><a href=""></a>            thought <span class="op">=</span> json_result[<span class="st">'Thought'</span>]</span>
<span id="cb54-19"><a href=""></a>            action <span class="op">=</span> json_result[<span class="st">'Action'</span>]</span>
<span id="cb54-20"><a href=""></a>            action_input <span class="op">=</span> json_result[<span class="st">'Action_Input'</span>]</span>
<span id="cb54-21"><a href=""></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\x1b</span><span class="ss">[34m Scratchpad: </span><span class="sc">{</span>scratchpad<span class="sc">}</span><span class="ss"> </span><span class="ch">\x1b</span><span class="ss">[0m"</span>)</span>
<span id="cb54-22"><a href=""></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\x1b</span><span class="ss">[34m Thought: </span><span class="sc">{</span>thought<span class="sc">}</span><span class="ss"> </span><span class="ch">\x1b</span><span class="ss">[0m"</span>)</span>
<span id="cb54-23"><a href=""></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\x1b</span><span class="ss">[36m  -- running </span><span class="sc">{</span>action<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(action_input)<span class="sc">}</span><span class="ch">\x1b</span><span class="ss">[0m"</span>)</span>
<span id="cb54-24"><a href=""></a>            <span class="cf">if</span> action <span class="op">+</span> <span class="st">": "</span> <span class="op">+</span> <span class="bu">str</span>(action_input) <span class="kw">in</span> previous_actions:</span>
<span id="cb54-25"><a href=""></a>                observation <span class="op">=</span> <span class="st">"You already run that action. **TRY A DIFFERENT ACTION INPUT.**"</span></span>
<span id="cb54-26"><a href=""></a>            <span class="cf">else</span>:</span>
<span id="cb54-27"><a href=""></a>                <span class="cf">if</span> action<span class="op">==</span><span class="st">"query_checker"</span>:</span>
<span id="cb54-28"><a href=""></a>                    <span class="cf">try</span>:</span>
<span id="cb54-29"><a href=""></a>                        observation <span class="op">=</span> query_checker_tool(<span class="bu">str</span>(action_input))</span>
<span id="cb54-30"><a href=""></a>                    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb54-31"><a href=""></a>                        observation <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb54-32"><a href=""></a>                <span class="cf">elif</span> action<span class="op">==</span><span class="st">"query_generator"</span>:</span>
<span id="cb54-33"><a href=""></a>                    <span class="cf">try</span>:</span>
<span id="cb54-34"><a href=""></a>                        observation <span class="op">=</span> query_generator_tool(<span class="bu">str</span>(action_input))</span>
<span id="cb54-35"><a href=""></a>                    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb54-36"><a href=""></a>                        observation <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb54-37"><a href=""></a>                <span class="cf">elif</span> action<span class="op">==</span><span class="st">"conversational_response"</span>:</span>
<span id="cb54-38"><a href=""></a>                    <span class="cf">try</span>:</span>
<span id="cb54-39"><a href=""></a>                        observation <span class="op">=</span> conversational_response(<span class="bu">str</span>(action_input))</span>
<span id="cb54-40"><a href=""></a>                        observation <span class="op">+=</span> <span class="st">"</span><span class="ch">\n</span><span class="st">Answer to the user."</span></span>
<span id="cb54-41"><a href=""></a>                    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb54-42"><a href=""></a>                        observation <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb54-43"><a href=""></a>            <span class="bu">print</span>()</span>
<span id="cb54-44"><a href=""></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\x1b</span><span class="ss">[33m Observation: </span><span class="sc">{</span>observation<span class="sc">}</span><span class="ss"> </span><span class="ch">\x1b</span><span class="ss">[0m"</span>)</span>
<span id="cb54-45"><a href=""></a>            <span class="bu">print</span>()</span>
<span id="cb54-46"><a href=""></a>            previous_actions.append(action <span class="op">+</span> <span class="st">": "</span> <span class="op">+</span> <span class="bu">str</span>(action_input))</span>
<span id="cb54-47"><a href=""></a>            next_prompt <span class="op">+=</span> (</span>
<span id="cb54-48"><a href=""></a>                <span class="st">"</span><span class="ch">\n</span><span class="st">Scratchpad: "</span> <span class="op">+</span> scratchpad <span class="op">+</span></span>
<span id="cb54-49"><a href=""></a>                <span class="st">"</span><span class="ch">\n</span><span class="st">Thought: "</span> <span class="op">+</span> thought <span class="op">+</span></span>
<span id="cb54-50"><a href=""></a>                <span class="st">"</span><span class="ch">\n</span><span class="st">Action: "</span> <span class="op">+</span> action  <span class="op">+</span></span>
<span id="cb54-51"><a href=""></a>                <span class="st">"</span><span class="ch">\n</span><span class="st">Action Input: "</span> <span class="op">+</span> action_input <span class="op">+</span></span>
<span id="cb54-52"><a href=""></a>                <span class="st">"</span><span class="ch">\n</span><span class="st">Observation: "</span> <span class="op">+</span> <span class="bu">str</span>(observation)</span>
<span id="cb54-53"><a href=""></a>            )</span>
<span id="cb54-54"><a href=""></a>        <span class="cf">else</span>:</span>
<span id="cb54-55"><a href=""></a>            scratchpad <span class="op">=</span> json_result[<span class="st">"Scratchpad"</span>]</span>
<span id="cb54-56"><a href=""></a>            final_answer <span class="op">=</span> json_result[<span class="st">"Final_Answer"</span>]</span>
<span id="cb54-57"><a href=""></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\x1b</span><span class="ss">[34m Scratchpad: </span><span class="sc">{</span>scratchpad<span class="sc">}</span><span class="ss"> </span><span class="ch">\x1b</span><span class="ss">[0m"</span>)</span>
<span id="cb54-58"><a href=""></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\x1b</span><span class="ss">[34m Final Answer: </span><span class="sc">{</span>final_answer<span class="sc">}</span><span class="ss"> </span><span class="ch">\x1b</span><span class="ss">[0m"</span>)</span>
<span id="cb54-59"><a href=""></a>            <span class="cf">return</span> final_answer</span>
<span id="cb54-60"><a href=""></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Final Answer: I am sorry, but I am unable to answer your question. Please provide more information or a different question."</span>)</span>
<span id="cb54-61"><a href=""></a>    <span class="cf">return</span> <span class="st">"No answer found"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="react-agent-7" class="slide level3">
<h3>ReAct Agent</h3>
<div id="808df81c-5c73-4bb7-b133-f6f9b02171c5" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T14:55:31.940924Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T14:55:31.940387Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T14:55:38.339476Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T14:55:38.339033Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T14:55:31.940881Z&quot;}" data-execution_count="61">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href=""></a>query(<span class="st">"Query the database to see which discovery did Pierre Curie do?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Scratchpad:  
 Thought: To find out what specific discovery Pierre Curie made, I should query the database for information related to his work. 
  -- running query_generator: MATCH (p:PERSON {name: 'Pierre Curie'})-[:DISCOVERED]-&gt;(d:DISCOVERY) RETURN d.name
 Cypher query: MATCH (p:PERSON {name: 'Pierre Curie'})-[:DISCOVERED]-&gt;(d:DISCOVERY) RETURN d.name 

 Observation: [d.name: ['Piezoelectricity']] 

 Scratchpad: Pierre Curie discovered piezoelectricity. 
 Final Answer: Pierre Curie discovered piezoelectricity. </code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>'Pierre Curie discovered piezoelectricity.'</code></pre>
</div>
</div>
</section>
<section id="react-agent-8" class="slide level3">
<h3>ReAct Agent</h3>
<div id="5810a77c-26c8-4e84-aa2d-20c512fdf280" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T14:56:10.817573Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T14:56:10.817029Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T14:56:17.290442Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T14:56:17.289996Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T14:56:10.817528Z&quot;}" data-execution_count="62">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href=""></a>query(<span class="st">"Query the database to see which discovery did Marie Curie do?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Scratchpad:  
 Thought: To find out which discovery Marie Curie is known for, I will query the database to search for her discoveries. 
  -- running query_generator: MATCH (p:PERSON {name: 'Marie Curie'})-[:DISCOVERED]-&gt;(d:DISCOVERY) RETURN d.name
 Cypher query: MATCH (p:PERSON {name: 'Marie Curie'})-[:DISCOVERED]-&gt;(d:DISCOVERY) RETURN d.name 

 Observation: [d.name: ['Radium', 'Polonium']] 

 Scratchpad: Marie Curie is known for discovering Radium and Polonium. 
 Final Answer: Marie Curie discovered Radium and Polonium. </code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>'Marie Curie discovered Radium and Polonium.'</code></pre>
</div>
</div>
</section>
<section id="react-agent-9" class="slide level3">
<h3>ReAct Agent</h3>
<div id="3cc8de62-2b40-490c-b1ae-21dd54d6d952" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-12-05T14:56:23.676951Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-12-05T14:56:23.676430Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-12-05T14:56:27.700905Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-12-05T14:56:27.700013Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-12-05T14:56:23.676906Z&quot;}" data-execution_count="63">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href=""></a>query(<span class="st">"Tell me a joke"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Scratchpad:  
 Thought: To provide a joke, I will use my knowledge base to find a suitable joke that is appropriate for all ages. 
  -- running conversational_response: Tell a family-friendly joke.

 Observation: Tell a family-friendly joke.
Answer to the user. 

 Scratchpad: To provide a joke, I will use my knowledge base to find a suitable joke that is appropriate for all ages. 
 Final Answer: Why don't scientists trust atoms? Because they make up everything! </code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>"Why don't scientists trust atoms? Because they make up everything!"</code></pre>
</div>
</div>
</section>
</section>
<section>
<section id="conclusions" class="title-slide slide level1 center">
<h1>Conclusions</h1>

</section>
<section id="conclusions-1" class="slide level3">
<h3>Conclusions</h3>
<ul>
<li>Structured Outputs + Structured Generation help us to generate Knowledge Graphs from unstructured data</li>
<li>Structured Outputs + Structured Generation help us create KG-based Agents that can query graph databases as well as calling other tools</li>
</ul>
</section>
<section id="references" class="slide level3" data-visibility="uncounted">
<h3>References</h3>
<ul>
<li><a href="https://blog.dottxt.co/coalescence.html">Coalescence</a> by <a href="https://twitter.com/willkurt">Will Kurt</a></li>
<li><a href="https://github.com/vivien000/regex-constrained-decoding">Fast, High-Fidelity LLM Decoding with Regex Constraints</a> by <a href="https://github.com/vivien000">Vivien Tran-Thien</a></li>
<li><a href="https://til.simonwillison.net/llms/python-react-pattern">A simple Python implementation of the ReAct pattern for LLMs</a> by <a href="https://simonwillison.net/">Simon Willison</a></li>
<li>Kùzu (graph DB) + Llama.cpp (inference) + Outlines (structured generation) + LangChain (framework) + Solara (visualization)</li>
</ul>
</section>
<section id="how-was-my-presentation" class="slide level3" data-visibility="uncounted">
<h3>How was my presentation?</h3>
<p>Please, leave me your anonymous feedback at <a href="https://www.admonymous.co/alonsosilva">https://www.admonymous.co/alonsosilva</a></p>

</section><div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="PyData-Global_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="PyData-Global_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="PyData-Global_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="PyData-Global_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="PyData-Global_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="PyData-Global_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="PyData-Global_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="PyData-Global_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="PyData-Global_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="PyData-Global_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>